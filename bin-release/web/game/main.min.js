var LoadingUI=function(e){function t(){e.call(this),this.createView()}__extends(t,e);var n=(__define,t),i=n.prototype;return i.createView=function(){this.textField=new egret.TextField,this.addChild(this.textField),this.textField.y=300,this.textField.width=480,this.textField.height=100,this.textField.textAlign="center"},i.setProgress=function(e,t){this.textField.text="Loading..."+e+"/"+t},t}(egret.Sprite);egret.registerClass(LoadingUI,"LoadingUI");var Main=function(e){function t(){e.call(this),this.addEventListener(egret.Event.ADDED_TO_STAGE,this.onAddToStage,this)}__extends(t,e);var n=(__define,t),i=n.prototype;return i.onAddToStage=function(e){this.removeEventListener(egret.Event.ADDED_TO_STAGE,this.onAddToStage,this),this.stage.registerImplementation("eui.IAssetAdapter",new AssetAdapter),this.stage.registerImplementation("eui.IThemeAdapter",new ThemeAdapter),App.DeviceUtils.IsPC?App.StageUtils.setScaleMode(egret.StageScaleMode.SHOW_ALL):App.DeviceUtils.IsMobile&&App.StageUtils.setScaleMode(egret.StageScaleMode.EXACT_FIT),this.initScene(),this.initModule(),App.SceneManager.runScene(SceneConsts.LOADING),this.loadResVersionComplate()},i.loadResVersionComplate=function(){App.ResourceUtils.addConfig("resource/default.res.json","resource/"),App.ResourceUtils.addConfig("resource/resource_core.json","resource/"),App.ResourceUtils.addConfig("resource/resource_ui.json","resource/"),App.ResourceUtils.addConfig("resource/resource_battle.json","resource/"),App.ResourceUtils.addConfig("resource/resource_puke.json","resource/"),App.ResourceUtils.loadConfig(this.onConfigComplete,this)},i.onConfigComplete=function(){var e=new eui.Theme("resource/default.thm.json",this.stage);e.addEventListener(eui.UIEvent.COMPLETE,this.onThemeLoadComplete,this)},i.onThemeLoadComplete=function(){var e=egret.getOption("roomid");void 0!=e&&null!=e&&RoomManager.setRoomInfo(e),new Startup},i.initScene=function(){App.SceneManager.register(SceneConsts.LOADING,new LoadingScene),App.SceneManager.register(SceneConsts.Enter,new EnterScene),App.SceneManager.register(SceneConsts.Home,new HomeScene),App.SceneManager.register(SceneConsts.Room,new RoomScene)},i.initModule=function(){App.ControllerManager.register(ControllerConst.Loading,new LoadingController)},t}(egret.DisplayObjectContainer);egret.registerClass(Main,"Main");var RoomTest=function(){function e(){var e="preload",t=["preload_core","preload_ui","preload_puke"];App.ResourceUtils.loadGroups(e,t,this.onResourceLoadComplete,this.onResourceLoadProgress,this)}var t=(__define,e),n=t.prototype;return n.onResourceLoadComplete=function(){App.Init(),this.initModule(),App.SoundManager.setBgOn(!0),App.SoundManager.setEffectOn(!App.DeviceUtils.IsHtml5||!App.DeviceUtils.IsMobile),App.SceneManager.runScene(SceneConsts.Room)},n.onResourceLoadProgress=function(e,t){App.ControllerManager.applyFunc(ControllerConst.Loading,LoadingConst.SetProgress,e,t)},n.initModule=function(){App.ControllerManager.register(ControllerConst.Room,new RoomController)},e}();egret.registerClass(RoomTest,"RoomTest");var Startup=function(){function e(){var e="preload",t=["preload_core","preload_ui","preload_puke"];App.ResourceUtils.loadGroups(e,t,this.onResourceLoadComplete,this.onResourceLoadProgress,this)}var t=(__define,e),n=t.prototype;return n.onResourceLoadComplete=function(){App.Init(),this.initModule(),this.initListener(),App.SoundManager.setBgOn(!1),App.SoundManager.setEffectOn(!App.DeviceUtils.IsHtml5||!App.DeviceUtils.IsMobile),App.SceneManager.runScene(SceneConsts.Enter)},n.onResourceLoadProgress=function(e,t){App.ControllerManager.applyFunc(ControllerConst.Loading,LoadingConst.SetProgress,e,t)},n.initModule=function(){App.ControllerManager.register(ControllerConst.Servers,new ServerChooseController),App.ControllerManager.register(ControllerConst.Login,new LoginController),App.ControllerManager.register(ControllerConst.Home,new HomeController),App.ControllerManager.register(ControllerConst.Room,new RoomController),App.ControllerManager.register(ControllerConst.RoomEnter,new RoomEnterController),App.ControllerManager.register(ControllerConst.ReplyDismiss,new ReplyDismissController)},n.initListener=function(){new RoomNotifyCmdListener(null)},e}();egret.registerClass(Startup,"Startup");var BaseProxy=function(){function e(e){this._controller=e}var t=(__define,e),n=t.prototype;return n.applyFunc=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];return this._controller.applyFunc.apply(this._controller,arguments)},n.applyControllerFunc=function(e,t){for(var n=[],i=2;i<arguments.length;i++)n[i-2]=arguments[i];return this._controller.applyControllerFunc.apply(this._controller,arguments)},n.receiveServerMsg=function(e,t,n){App.MessageCenter.addListener(e,t,n)},n.receiveServerMsgOnce=function(e,t,n){var i=function(r){this.removeServerMsg(e,i,this),t.apply(n,r)};this.receiveServerMsg(e,i,this)},n.receiveServerHttpUpdateMsg=function(e,t,n){this.receiveServerMsg(e+"_HttpUpdate",t,n)},n.receiveServerHttpUpdateMsgOnce=function(e,t,n){this.receiveServerMsgOnce(e+"_HttpUpdate",t,n)},n.removeServerMsg=function(e,t,n){App.MessageCenter.removeListener(e,t,n)},n.removeServerHttpUpdateMsg=function(e,t,n){this.removeServerMsg(e+"_HttpUpdate",t,n)},n.sendSocketMsg=function(e){App.Socket.send(e)},n.sendSocketPBMsg=function(e,t){App.Socket.send({cmd:e,body:t})},n.sendSocketCBMsg=function(e,t){App.Socket.send({cmd:e,body:t})},n.sendSocketCHBMsg=function(e,t,n){n.head=t,App.Socket.send({cmd:e,body:n})},n.sendSocketCEBMsg=function(e,t,n){n.head.err=t,App.Socket.send({cmd:e,body:n})},n.writeAndFlush=function(e,t){App.Socket.writeAndFlush(e,0,t)},n.writeAndFlushFlag=function(e,t,n){App.Socket.writeAndFlush(e,n,t)},n.sendHttpMsg=function(e,t){void 0===t&&(t=null),App.Http.send(e,this.getURLVariables(e,t))},n.getURLVariables=function(e,t){var n=e.split("."),i={};i.mod=n[0],i["do"]=n[1],null!=t&&(i.p=t);var r=JSON.stringify(i),s=new egret.URLVariables("data="+r+"&h="+App.ProxyUserFlag);return s},e}();egret.registerClass(BaseProxy,"BaseProxy");var RoomNotifyCmdListener=function(e){function t(t){e.call(this,t),this.receiveServerMsg(Cmd.ROOM_NOTIFY,this.onRoomNotify,this)}__extends(t,e);var n=(__define,t),i=n.prototype;return i.onRoomNotify=function(e){switch(e.notify.type){case NotifyType.NOOP:break;case NotifyType.ROOM_CLOSE:this.closeRoom(e.notify);break;case NotifyType.PLAYER_ENTER:this.playerEnter(e.notify);break;case NotifyType.PLAYER_LEAVE:this.playerLeave(e.notify);break;case NotifyType.ASK_DISMISS_ROOM:this.askDismissRoom(e.notify);break;case NotifyType.ROOM_START:this.startRoom(e.notify);break;case NotifyType.REPLY_DISMISS_ROOM:this.replyDismissRoom(e.notify);break;case NotifyType.FAIL_DISMISS_ROOM:this.failDismissRoom(e.notify);break;default:App.TipsUtils.showCenter("未知通知："+e.notify.type)}},i.closeRoom=function(e){var t=e.roomClose;if(RoomManager.hasRoomInfo&&t.roomid==RoomManager.roomId){switch(t.reason){case RoomCloseReason.EMPTY:App.TipsUtils.showCenter("房间无人");break;case RoomCloseReason.DISMISS:App.TipsUtils.showCenter("房间已解散");break;case RoomCloseReason.ROOMSRV_CLOSE:App.TipsUtils.showCenter("服务器停服")}App.SceneManager.getCurrScene()!=SceneConsts.Home.valueOf()&&App.SceneManager.runScene(SceneConsts.Home),App.SceneManager.runScene(SceneConsts.Home)}else App.TipsUtils.showCenter("房间关闭数据有误"+t.roomid)},i.playerEnter=function(e){var t=e.playerEnter;RoomManager.hasRoomInfo?(RoomManager.addPlayer(t.enterer),App.SceneManager.getCurrScene()!=SceneConsts.Room.valueOf()?App.SceneManager.runScene(SceneConsts.Room):App.MessageCenter.dispatch(NotifyConst.PLAYER_ENTER)):(Log.trace(e),App.TipsUtils.showCenter("系统错误：无房间信息，玩家不可进入"))},i.playerLeave=function(e){var t=e.playerLeave,n=t.leaver;void 0!=n&&null!=n&&(RoomManager.removePlayer(n.uid),App.MessageCenter.dispatch(NotifyConst.PLAYER_LEAVE))},i.askDismissRoom=function(e){var t=e.askDismiss,n=t.dismisser;if(void 0!=n&&null!=n){var i=t.askSecond,r=t.waitSeconds,s=RoomManager.getPlayer(n);null!=s?(App.TipsUtils.showCenter(s.nick+"发起解散，发起时间："+i+"，剩余时间："+r),App.ViewManager.open(ViewConst.ReplyDismiss)):App.TipsUtils.showCenter("系统错误：该玩家不可发起解散请求，玩家id="+n)}App.ViewManager.open(ViewConst.ReplyDismiss)},i.startRoom=function(e){var t=e.roomStart,n=t.roomid;RoomManager.hasRoomInfo&&RoomManager.roomId==n?App.MessageCenter.dispatch(NotifyConst.ROOM_START):App.TipsUtils.showCenter("系统错误：游戏开始失败，不在此房间，roomid="+n)},i.replyDismissRoom=function(e){var t=e.replyDismiss,n=(t.replier,t.agree);n?App.TipsUtils.showCenter("同意解散"):App.TipsUtils.showCenter("不同意解散")},i.failDismissRoom=function(e){var t=e.failDismiss,n=(t.roomid,t.reason);0==n?App.TipsUtils.showCenter("解除失败，多数不同意"):App.TipsUtils.showCenter("解除失败，原因未知，reason="+n)},t}(BaseProxy);egret.registerClass(RoomNotifyCmdListener,"RoomNotifyCmdListener");var Menu=function(e){function t(){e.call(this)}__extends(t,e);var n=(__define,t);n.prototype;return t}(eui.Component);egret.registerClass(Menu,"Menu");var Cmd=function(){function e(){}var t=(__define,e);t.prototype;return e.GM=901,e.LOGIN=1,e.ROOM_CREATE=101,e.ROOM_DISMISS=102,e.ROOM_ENTER=103,e.ROOM_LEAVE=104,e.ROOM_PLAYER_INFO_GET=105,e.ROOM_NOTIFY=106,e.ROOM_ASK_DISMISS=107,e.ROOM_REPLY_DISMISS=108,e}();egret.registerClass(Cmd,"Cmd");var ControllerConst;!function(e){e[e.Loading=1e4]="Loading",e[e.Login=10001]="Login",e[e.Home=10002]="Home",e[e.Servers=10003]="Servers",e[e.Room=10004]="Room",e[e.RoomEnter=10005]="RoomEnter",e[e.ReplyDismiss=10006]="ReplyDismiss"}(ControllerConst||(ControllerConst={}));var GamingStates=function(){function e(){}var t=(__define,e);t.prototype;return e.NONE=0,e.WAITING=1,e.READY_GET=2,e.BETTING=3,e.GETTING=4,e.GAMING=5,e.STOP=6,e.BOOM=7,e.SETTLEMENT=8,e.END=9,e}();egret.registerClass(GamingStates,"GamingStates");var HttpConst=function(){function e(){}var t=(__define,e);t.prototype;return e.USER_LOGIN="User.login",e}();egret.registerClass(HttpConst,"HttpConst");var Msg=function(){function e(){}var t=(__define,e);t.prototype;return e.ERR="errpb.ERR",e.Head="cspb.Head",e.User="storepb.User",e.Player="storepb.Player",e.RegInfo="storepb.User.RegInfo",e.DEBUG="cspb.LoginReq.Debug",e.WECHAT="cspb.LoginReq.Wechat",e.LoginReq="cspb.LoginReq",e.LoginResp="cspb.LoginResp",e.CreateRoomReq="cspb.CreateRoomReq",e.CreateRoomResp="cspb.CreateRoomResp",e.DismissRoomReq="cspb.DismissRoomReq",e.DismissRoomResp="cspb.DismissRoomResp",e.EnterRoomReq="cspb.EnterRoomReq",e.EnterRoomResp="cspb.EnterRoomResp",e.LeaveRoomReq="cspb.LeaveRoomReq",e.LeaveRoomResp="cspb.LeaveRoomResp",e.GetRoomPlayerInfoReq="cspb.GetRoomPlayerInfoReq",e.GetRoomPlayerInfoResp="cspb.GetRoomPlayerInfoResp",e.AskDismissRoomReq="cspb.AskDismissRoomReq",e.AskDismissRoomResp="cspb.AskDismissRoomResp",e.ReplyDismissRoomReq="cspb.ReplyDismissRoomReq",e.ReplyDismissRoomResp="cspb.ReplyDismissRoomResp",e.RoomNotify="cspb.RoomNotify",e.TextMsg="talkpb.TextMsg",e}();egret.registerClass(Msg,"Msg");var NotifyConst=function(){function e(){}var t=(__define,e);t.prototype;return e.NOOP="NotifyType.NOOP",e.ROOM_CLOSE="NotifyType.ROOM_CLOSE",e.PLAYER_ENTER="NotifyType.PLAYER_ENTER",e.PLAYER_LEAVE="NotifyType.PLAYER_LEAVE",e.ROOM_DISMISS_REQ="NotifyType.ROOM_DISMISS_REQ",e.ROOM_START="NotifyType.ROOM_START",e}();egret.registerClass(NotifyConst,"NotifyConst");var NotifyType=function(){function e(){}var t=(__define,e);t.prototype;return e.NOOP=0,e.ROOM_CLOSE=1,e.PLAYER_ENTER=2,e.PLAYER_LEAVE=3,e.ASK_DISMISS_ROOM=4,e.ROOM_START=5,e.REPLY_DISMISS_ROOM=6,e.FAIL_DISMISS_ROOM=7,e}();egret.registerClass(NotifyType,"NotifyType");var ProtoConst=function(){function e(){}var t=(__define,e);t.prototype;return e.CS="cspb",e.ERR="errpb",e.ROOM="roompb",e.STORE="storepb",e.TALK="talkpb",e}();egret.registerClass(ProtoConst,"ProtoConst");var RoomCloseReason=function(){function e(){}var t=(__define,e);t.prototype;return e.EMPTY=0,e.DISMISS=1,e.ROOMSRV_CLOSE=2,e}();egret.registerClass(RoomCloseReason,"RoomCloseReason");var SceneConsts;!function(e){e[e.Enter=1]="Enter",e[e.Room=2]="Room",e[e.Home=3]="Home",e[e.LOADING=4]="LOADING"}(SceneConsts||(SceneConsts={}));var ViewConst;!function(e){e[e.Loading=1e4]="Loading",e[e.ServerChoose=10001]="ServerChoose",e[e.Login=10002]="Login",e[e.Home=10003]="Home",e[e.Room=2e4]="Room",e[e.RoomUI=20001]="RoomUI",e[e.RoomEnter=20002]="RoomEnter",e[e.ReplyDismiss=20003]="ReplyDismiss"}(ViewConst||(ViewConst={}));var GamingManager=function(){function e(){}var t=__define,n=e;n.prototype;return t(e,"state",function(){return this._state},function(e){this._state=e}),e._state=GamingStates.NONE,e}();egret.registerClass(GamingManager,"GamingManager");var MahjongManager=function(){function e(){}var t=(__define,e);t.prototype;return e.random=function(t){for(var n,i=new Array,r=1;i.length<t;){for(var s=Math.floor(58*Math.random())+10;-1==e.mids.indexOf(s);)s=Math.floor(58*Math.random())+10;n=new MahjongInfo,n.id=r,n.mid=s,i.push(n),r++}return i},e.mids=[11,12,13,14,15,16,17,18,19,21,22,23,24,25,26,27,28,29,,31,32,33,34,35,36,37,38,39,,41,42,43,44,45,46,47,,51,52,53,54,55,56,57,58],e}();egret.registerClass(MahjongManager,"MahjongManager");var MainManager=function(){function e(){}var t=__define,n=e;n.prototype;return e.setUserInfo=function(e){this._userInfo=new UserInfo(e),this._userId=this._userInfo.uid,App.Head.uid=e.uid},t(e,"userId",function(){return this._userId}),t(e,"userInfo",function(){return this._userInfo}),e}();egret.registerClass(MainManager,"MainManager");var ProtoManager=function(){function e(){}var t=(__define,e);t.prototype;return e.getProtoContents=function(){var e=new Array;return e.push(RES.getRes("cspb")),e.push(RES.getRes("errpb")),e.push(RES.getRes("roompb")),e.push(RES.getRes("srvmetapb")),e.push(RES.getRes("storepb")),e.push(RES.getRes("talkpb")),e.push(RES.getRes("gmpb")),e},e}();egret.registerClass(ProtoManager,"ProtoManager");var PukeManager=function(){function e(){}var t=(__define,e);t.prototype;return e.randomOne=function(t){for(var n=Math.floor(Math.random()*e.PID_MAX)+e.PID_MIN;-1==e.pids.indexOf(n);)n=Math.floor(Math.random()*e.PID_MAX)+e.PID_MIN;var i=new PukeInfo;return i.id=t,i.pid=n,i.points=e.points[e.pids.indexOf(n)],i},e.random=function(t){for(var n,i=new Array,r=1;i.length<t;){for(var s=Math.floor(Math.random()*e.PID_MAX)+e.PID_MIN;-1==e.pids.indexOf(s);)s=Math.floor(Math.random()*e.PID_MAX)+e.PID_MIN;n=new PukeInfo,n.id=r,n.pid=s,i.push(n),r++}return i},e.pids=[101,102,103,104,105,106,107,108,109,110,111,112,113,201,202,203,204,205,206,207,208,209,210,211,212,213,,301,302,303,304,305,306,307,308,309,310,311,312,313,,401,402,403,404,405,406,407,408,409,410,411,412,413,,501,502],e.points=[1,2,3,4,5,6,7,8,9,10,.5,.5,.5,1,2,3,4,5,6,7,8,9,10,.5,.5,.5,,1,2,3,4,5,6,7,8,9,10,.5,.5,.5,,1,2,3,4,5,6,7,8,9,10,.5,.5,.5,,.5,.5],e.PID_MIN=101,e.PID_MAX=502,e}();egret.registerClass(PukeManager,"PukeManager");var RoomManager=function(){function e(){}var t=__define,n=e;n.prototype;return t(e,"playerIds",function(){for(var t=new Array,n=0;n<e.playerCount;n++)t.push(this._players[n].uid);return t}),e.addPlayer=function(t){return this._players.length>e.MAX_PLAYER_CNT?-1:this._players.push(t)},e.removePlayer=function(t){for(var n=e.playerCount,i=0;n>i;i++)if(this._players[i].uid==t)return this._players.splice(i,1),!0;return!1},e.getPlayer=function(t){for(var n=e.playerCount,i=0;n>i;i++)if(this._players[i].uid==t)return this._players[i];return null},e.parsePlayers=function(t,n){Log.trace("parse",n),e.clearPlayers();for(var i=0;i<t.length;i++)e.addPlayer(t[i])},e.setRoomInfo=function(e){this._roomId=e},e.clearPlayers=function(){this._players=[]},t(e,"playerCount",function(){return this._players.length}),t(e,"players",function(){return this._players}),t(e,"isOb",function(){return this._isOb},function(e){this._isOb=e}),t(e,"roomId",function(){return this._roomId},function(e){this._roomId=e}),t(e,"seatId",function(){return this._seatId},function(e){this._seatId=e}),t(e,"hasRoomInfo",function(){return null!=this._roomId&&""!=this._roomId}),e.clearRoomInfo=function(){this._roomId=null,this._seatId=0},e.MAX_PLAYER_CNT=4,e._players=new Array,e._isOb=!1,e}();egret.registerClass(RoomManager,"RoomManager");var BMahjongBar=function(e){function t(){e.call(this),this._infos=new Array,this._items=new Array}__extends(t,e);var n=__define,i=t,r=i.prototype;return n(r,"data",void 0,function(e){this._infos=e,this.render()}),r.switchItem=function(e){null==this._curtItem?(this._curtItem=e,this._curtItem.switchMove()):(this._curtItem!=e&&this._curtItem.revertPos(),this._curtItem=e,this._curtItem.switchMove())},r.render=function(){this.removeAllChildren();var e,n=this._infos.length;this._infos.sort(this.sortFun);for(var i=0;n>i;i++)i>this._items.length-1&&(e=new MahjongItem,this._items.push(e)),e=this._items[i],e.info=this._infos[i],this.addChild(e),egret.Tween.get(e).to({x:t.ITEM_WIDTH*i},1e3)},r.sortFun=function(e,t){return e.mid==t.mid?0:e.mid>t.mid?1:-1},r.removeAllChildren=function(){for(;this.numChildren>0;){var e=this.removeChildAt(0);e.x=0,e.y=0}},t.ITEM_WIDTH=40,t.ITEM_HEIGHT=60,t}(eui.Component);egret.registerClass(BMahjongBar,"BMahjongBar");var BaseMahjongItem=function(e){function t(){e.call(this)}__extends(t,e);var n=(__define,t);n.prototype;return t}(eui.Component);egret.registerClass(BaseMahjongItem,"BaseMahjongItem");var MahjongItem=function(e){function t(){e.call(this),this._status=0,this._status=0,this._img=new egret.Bitmap,this.addChild(this._img),this._img.width=BMahjongBar.ITEM_WIDTH,this._img.height=BMahjongBar.ITEM_HEIGHT}__extends(t,e);var n=__define,i=t,r=i.prototype;return n(r,"info",void 0,function(e){this._info=e,this.refresh()}),r.switchMove=function(){egret.Tween.removeTweens(this),0==this._status?(this._status=1,egret.Tween.get(this).to({y:-20},300)):(this._status=0,egret.Tween.get(this).to({y:0},300))},r.revertPos=function(){egret.Tween.get(this).to({y:0},300)},r.discard=function(){},r.refresh=function(){null!=this._info&&(this._img.texture=RES.getRes("mj"+this._info.mid))},t}(BaseMahjongItem);egret.registerClass(MahjongItem,"MahjongItem");var MahjongInfo=function(){function e(){}var t=__define,n=e,i=n.prototype;return t(i,"id",function(){return this._id},function(e){this._id=e}),t(i,"mid",function(){return this._mid},function(e){this._mid=e}),e}();egret.registerClass(MahjongInfo,"MahjongInfo");var PlayerInfo=function(){function e(e){null!=e&&(this._onlineId=e.roleTime,this._uid=e.uid,this._nick=e.nick,this._seatId=e.seatId,this._obId=e.obId,this._ob=e.ob,this._icon=e.icon,this._ip=e.ip,this._inRoom=e.inRoom)}var t=__define,n=e,i=n.prototype;return t(i,"uid",function(){return this._uid}),t(i,"nick",function(){return this._nick}),t(i,"seatId",function(){return this._seatId}),t(i,"obId",function(){return this._obId}),t(i,"isOb",function(){return this._ob}),t(i,"inRoom",function(){return this._inRoom}),e}();egret.registerClass(PlayerInfo,"PlayerInfo");var PukeInfo=function(){function e(){}var t=__define,n=e,i=n.prototype;return t(i,"id",function(){return this._id},function(e){this._id=e}),t(i,"pid",function(){return this._pid},function(e){this._pid=e}),t(i,"points",function(){return this._points},function(e){this._points=e}),e}();egret.registerClass(PukeInfo,"PukeInfo");var UserInfo=function(){function e(e){null!=e&&(this._uid=e.uid,this._nick=e.nick,this._icon=e.icon,this._lastLoginTime=e.last_login_time,this._roomCard=e.room_card)}var t=__define,n=e,i=n.prototype;return t(i,"uid",function(){return this._uid}),t(i,"nick",function(){return this._nick}),t(i,"roomCard",function(){return this._roomCard}),e}();egret.registerClass(UserInfo,"UserInfo");var BaseEuiView=function(e){function t(t,n){e.call(this),this._resources=null,this._controller=t,this._myParent=n,this._isInit=!1,this.percentHeight=100,this.percentWidth=100}__extends(t,e);var n=__define,i=t,r=i.prototype;return n(r,"myParent",function(){return this._myParent}),r.setResources=function(e){this._resources=e},r.isInit=function(){return this._isInit},r.applyFunc=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];return this._controller.applyFunc.apply(this._controller,arguments)},r.applyControllerFunc=function(e,t){for(var n=[],i=2;i<arguments.length;i++)n[i-2]=arguments[i];return this._controller.applyControllerFunc.apply(this._controller,arguments)},r.isShow=function(){return null!=this.stage&&this.visible},r.addToParent=function(){this._myParent.addChild(this)},r.removeFromParent=function(){App.DisplayUtils.removeFromParent(this)},r.initUI=function(){this._isInit=!0},r.initData=function(){},r.destroy=function(){this._controller.destroy(),this._controller=null,this._myParent=null,this._resources=null},r.open=function(){for(var e=[],t=0;t<arguments.length;t++)e[t-0]=arguments[t];this._controller.addEvents()},r.close=function(){for(var e=[],t=0;t<arguments.length;t++)e[t-0]=arguments[t];this._controller.removeEvents()},r.loadResource=function(e,t){this._resources&&this._resources.length>0?(App.ResourceUtils.loadResource(this._resources,[],e,null,this),this.addEventListener(eui.UIEvent.CREATION_COMPLETE,t,this)):(e(),t())},r.setVisible=function(e){this.visible=e},t}(eui.Component);egret.registerClass(BaseEuiView,"BaseEuiView",["IBaseView"]);var BasePanelView=function(e){function t(t,n){e.call(this,t,n),this.skinName="resource/skins/PanelSkin.exml"}__extends(t,e);var n=__define,i=t,r=i.prototype;return n(r,"icon",function(){return this._icon},function(e){this._icon=e,this.iconDisplay&&(this.iconDisplay.source=this._icon)}),n(r,"btn",function(){return this._btn},function(e){this._btn=e,this.button&&(this.button.source=this._btn)}),r.initUI=function(){e.prototype.initUI.call(this),this.closeBtn.addEventListener(egret.TouchEvent.TOUCH_END,this.closeBtnClickHandler,this)},r.initData=function(){e.prototype.initData.call(this),this.iconDisplay.source=this._icon,this.button.source=this._btn},r.closeBtnClickHandler=function(e){App.ViewManager.closeView(this)},t}(BaseEuiView);egret.registerClass(BasePanelView,"BasePanelView");var HomeConst=function(){function e(){}var t=(__define,e);t.prototype;return e.ROOM_CREATE_REQ="home.create.room.req",e.ROOM_CREATE_RESP="home.create.room.resp",e.ROOM_ENTER_REQ="home.enter.room.req",e.ROOM_ENTER_RESP="home.enter.room.resp",e.NOTIFY="home.notify",e.GM="home.room.gm",e}();egret.registerClass(HomeConst,"HomeConst");var BaseController=function(){function e(){this._messages={}}var t=(__define,e),n=t.prototype;return n.registerFunc=function(e,t,n){this._messages[e]=[t,n]},n.removeFunc=function(e){this._messages[e]=null},n.addEvents=function(){},n.removeEvents=function(){},n.applyFunc=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];var i=this._messages[e];return i?i[0].apply(i[1],t):(Log.trace("消息["+e+"]不存在侦听"),null)},n.applyControllerFunc=function(e,t){for(var n=[],i=2;i<arguments.length;i++)n[i-2]=arguments[i];return App.ControllerManager.applyFunc.apply(App.ControllerManager,arguments)},n.setModel=function(e){this._model=e},n.getModel=function(){return this._model},n.getControllerModel=function(e){return App.ControllerManager.getControllerModel(e)},n.destroy=function(){},e}();egret.registerClass(BaseController,"BaseController");var HomeController=function(e){function t(){e.call(this),this.proxy=new HomeProxy(this),this.homeView=new HomeView(this,LayerManager.UI_Main),App.ViewManager.register(ViewConst.Home,this.homeView)}__extends(t,e);var n=(__define,t),i=n.prototype;return i.addEvents=function(){this.registerFunc(HomeConst.ROOM_CREATE_REQ,this.onCreate,this),this.registerFunc(HomeConst.ROOM_ENTER_REQ,this.onEnter,this),this.registerFunc(HomeConst.ROOM_CREATE_RESP,this.createResp,this),this.registerFunc(HomeConst.ROOM_ENTER_RESP,this.enterResp,this),this.registerFunc(HomeConst.GM,this.gmReq,this)},i.removeEvents=function(){this.removeFunc(HomeConst.ROOM_CREATE_REQ),this.removeFunc(HomeConst.ROOM_ENTER_REQ),this.removeFunc(HomeConst.ROOM_CREATE_RESP),this.removeFunc(HomeConst.ROOM_ENTER_RESP),this.removeFunc(HomeConst.GM)},i.onCreate=function(){this.proxy.createRoom()},i.onEnter=function(){this.proxy.enterRoom()},i.gmReq=function(e,t){this.proxy.gmReq(e,t)},i.createResp=function(e){this.homeView.createRoomSuccess(),App.TipsUtils.showCenter("创建房间 roomId:"+e)},i.enterResp=function(e){RoomManager.parsePlayers(e.players,"home"),App.SceneManager.runScene(SceneConsts.Room)},t}(BaseController);egret.registerClass(HomeController,"HomeController");var HomeProxy=function(e){function t(t){e.call(this,t),this.receiveServerMsg(Cmd.ROOM_CREATE,this.createRoomSuccess,this),this.receiveServerMsg(Cmd.ROOM_ENTER,this.enterRoomSuccess,this)}__extends(t,e);var n=(__define,t),i=n.prototype;return i.createRoom=function(){var e={head:App.Head};this.writeAndFlush(Cmd.ROOM_CREATE,e)},i.enterRoom=function(){if(!RoomManager.hasRoomInfo)return void App.TipsUtils.showCenter("无房间数据");var e={head:App.Head,ob:RoomManager.isOb,roomid:RoomManager.roomId};this.writeAndFlush(Cmd.ROOM_ENTER,e)},i.gmReq=function(e,t){var n={head:App.Head,cmd:e,text:t};this.writeAndFlush(Cmd.GM,n)},i.createRoomSuccess=function(e){RoomManager.setRoomInfo(e.roomid),this.applyFunc(HomeConst.ROOM_CREATE_RESP,RoomManager.roomId)},i.enterRoomSuccess=function(e){this.applyFunc(HomeConst.ROOM_ENTER_RESP,e)},t}(BaseProxy);egret.registerClass(HomeProxy,"HomeProxy");var HomeView=function(e){function t(t,n){e.call(this,t,n),App.DebugUtils.isDebug?this.skinName="resource/skins/HomeViewDebugSkin.exml":App.DeviceUtils.IsMobile?this.skinName="resource/skins/vmobile/HomeViewMSkin.exml":this.skinName="resource/skins/GuiScreenSkin.exml"}__extends(t,e);var n=(__define,t),i=n.prototype;return i.initUI=function(){e.prototype.initUI.call(this),this.createBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.createClickHandler,this),this.enterBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.enterClickHandler,this),this.crossEnterBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.crossEnterClickHandler,this),App.DebugUtils.isDebug&&this.sendBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.sendClickHandler,this)},i.playSound=function(){App.SoundManager.playEffect("sound_dianji")},i.open=function(){for(var t=[],n=0;n<arguments.length;n++)t[n-0]=arguments[n];e.prototype.open.call(this,t),this.refreshView()},i.createClickHandler=function(e){this.applyFunc(HomeConst.ROOM_CREATE_REQ)},i.enterClickHandler=function(e){RoomManager.hasRoomInfo?this.applyFunc(HomeConst.ROOM_ENTER_REQ):App.ViewManager.open(ViewConst.RoomEnter)},i.crossEnterClickHandler=function(){App.ViewManager.open(ViewConst.RoomEnter)},i.sendClickHandler=function(e){if(null!=this.cmdInput&&""!=this.cmdInput.text){var t=parseInt(this.cmdInput.text);this.applyFunc(HomeConst.GM,t,this.bodyInput.text)}},i.friendClickHandler=function(e){},i.shopClickHandler=function(e){this.playSound()},i.warehouseClickHandler=function(e){this.playSound()},i.factoryClickHandler=function(e){this.playSound()},i.moreClickHandler=function(e){this.playSound()},i.menuBtnChangeHandler=function(e){this.playSound(),this.menu&&(this.menu.visible=this.menuBtn.selected)},i.menuClickHandler=function(e){console.log(e.target),e.target==this.menu.taskBtn?(this.playSound(),this.menuBtn.selected=!1,this.menu.visible=!1):e.target==this.menu.dailyBtn?(this.playSound(),this.menuBtn.selected=!1,this.menu.visible=!1):e.target==this.menu.mailBtn&&(this.playSound(),this.menuBtn.selected=!1,this.menu.visible=!1)},i.createRoomSuccess=function(){this.refreshView()},i.refreshView=function(){this.nameDisplay.text=MainManager.userInfo.nick,this.coinsDisplay.text=""+MainManager.userInfo.roomCard,RoomManager.hasRoomInfo?(this.createBtn.enabled=!1,this.enterBtn.enabled=!0,this.enterBtn.label="进入【"+RoomManager.roomId+"】房间",this.roomLabel.text="房间号："+RoomManager.roomId):(this.createBtn.enabled=!0,this.enterBtn.enabled=!1,this.enterBtn.label="进入房间",this.roomLabel.text="房间")},t}(BaseEuiView);egret.registerClass(HomeView,"HomeView");var BaseClass=function(){function e(){}var t=(__define,e);t.prototype;return e.getInstance=function(){for(var e=[],t=0;t<arguments.length;t++)e[t-0]=arguments[t];var n=this;if(!n._instance){var i=e.length;0==i?n._instance=new n:1==i?n._instance=new n(e[0]):2==i?n._instance=new n(e[0],e[1]):3==i?n._instance=new n(e[0],e[1],e[2]):4==i?n._instance=new n(e[0],e[1],e[2],e[3]):5==i&&(n._instance=new n(e[0],e[1],e[2],e[3],e[4]))}return n._instance},e}();egret.registerClass(BaseClass,"BaseClass");var EasyLoading=function(e){function t(){e.call(this),this.content=null,this.speed=.6,this.init()}__extends(t,e);var n=(__define,t),i=n.prototype;return i.init=function(){this.averageUtils=new AverageUtils,this.content=new egret.Sprite,this.content.graphics.beginFill(0,.2),this.content.graphics.drawRect(0,0,App.StageUtils.getWidth(),App.StageUtils.getHeight()),this.content.graphics.endFill(),this.content.touchEnabled=!0,this.uiImageContainer=new egret.DisplayObjectContainer,this.uiImageContainer.x=.5*this.content.width,this.uiImageContainer.y=.5*this.content.height,this.content.addChild(this.uiImageContainer),RES.getResByUrl("resource/assets/load_Reel.png",function(e){var t=new egret.Bitmap;t.texture=e,t.x=.5*-t.width,t.y=.5*-t.height,this.uiImageContainer.addChild(t)},this,RES.ResourceItem.TYPE_IMAGE)},i.showLoading=function(){App.StageUtils.getStage().addChild(this.content),App.TimerManager.doFrame(1,0,this.enterFrame,this)},i.hideLoading=function(){this.content&&this.content.parent&&(App.StageUtils.getStage().removeChild(this.content),this.uiImageContainer.rotation=0),App.TimerManager.remove(this.enterFrame,this)},i.enterFrame=function(e){this.averageUtils.push(this.speed*e),this.uiImageContainer.rotation+=this.averageUtils.getValue()},t}(BaseClass);egret.registerClass(EasyLoading,"EasyLoading");var LoadingConst=function(){function e(){}var t=(__define,e);t.prototype;return e.SetProgress=10001,e}();egret.registerClass(LoadingConst,"LoadingConst");var LoadingController=function(e){function t(){e.call(this),this.loadingView=new LoadingView(this,LayerManager.UI_Main),App.ViewManager.register(ViewConst.Loading,this.loadingView),this.registerFunc(LoadingConst.SetProgress,this.setProgress,this)}__extends(t,e);var n=(__define,t),i=n.prototype;return i.setProgress=function(e,t){this.loadingView.setProgress(e,t)},t}(BaseController);egret.registerClass(LoadingController,"LoadingController");var LoadingView=function(e){function t(t,n){e.call(this,t,n),this.skinName="resource/skins/LoadingUISkin.exml"}__extends(t,e);var n=(__define,t),i=n.prototype;return i.setProgress=function(e,t){this.txtMsg.text="资源加载中..."+e+"/"+t},t}(BaseEuiView);egret.registerClass(LoadingView,"LoadingView");var LoginConst=function(){function e(){}var t=(__define,e);t.prototype;return e.LOGIN_REQ="login.req",e.LOGIN_RESP="login.resp",e.ROOM_ENTER_REQ="login.enter.room.req",e.ROOM_ENTER_RESP="login.enter.room.resp",e}();egret.registerClass(LoginConst,"LoginConst");var LoginController=function(e){function t(){e.call(this),this.loginView=new LoginView(this,LayerManager.UI_Main),App.ViewManager.register(ViewConst.Login,this.loginView),this.loginProxy=new LoginProxy(this)}__extends(t,e);var n=(__define,t),i=n.prototype;return i.addEvents=function(){this.registerFunc(LoginConst.LOGIN_REQ,this.onLogin,this),this.registerFunc(LoginConst.LOGIN_RESP,this.loginSuccess,this),this.registerFunc(LoginConst.ROOM_ENTER_RESP,this.enterResp,this)},i.removeEvents=function(){this.removeFunc(LoginConst.LOGIN_REQ),this.removeFunc(LoginConst.LOGIN_RESP),this.removeFunc(LoginConst.ROOM_ENTER_RESP)},i.onLogin=function(e,t,n){this.loginProxy.login(e,t,n)},i.loginSuccess=function(e){this.loginView.loginSuccess(),RoomManager.hasRoomInfo?this.loginProxy.enterRoom():App.SceneManager.runScene(SceneConsts.Home)},i.enterResp=function(e){RoomManager.parsePlayers(e.players,"login"),App.SceneManager.runScene(SceneConsts.Room)},t}(BaseController);egret.registerClass(LoginController,"LoginController");var BaseModel=function(){function e(e){this._controller=e,this._controller.setModel(this)}var t=(__define,e);t.prototype;return e}();egret.registerClass(BaseModel,"BaseModel");var LoginModel=function(e){function t(t){e.call(this,t)
}__extends(t,e);var n=(__define,t);n.prototype;return t}(BaseModel);egret.registerClass(LoginModel,"LoginModel");var LoginProxy=function(e){function t(t){e.call(this,t),this.receiveServerMsg(Cmd.LOGIN,this.loginSuccess,this),this.receiveServerMsg(Cmd.ROOM_ENTER,this.enterRoomSuccess,this)}__extends(t,e);var n=(__define,t),i=n.prototype;return i.login=function(e,t,n){var i=App.lookupProtoMessage(Msg.DEBUG).create({openid:e,nick:n}),r=(App.lookupProtoMessage(Msg.WECHAT).create({code:t}),{head:App.Head,debug:i,type:0});this.writeAndFlush(Cmd.LOGIN,r)},i.enterRoom=function(){if(!RoomManager.hasRoomInfo)return void App.TipsUtils.showCenter("无房间数据");var e={head:App.Head,ob:RoomManager.isOb,roomid:RoomManager.roomId};this.writeAndFlush(Cmd.ROOM_ENTER,e)},i.loginSuccess=function(e){MainManager.setUserInfo(e.player),RoomManager.roomId=e.roomid,this.applyFunc(LoginConst.LOGIN_RESP,e)},i.enterRoomSuccess=function(e){this.applyFunc(LoginConst.ROOM_ENTER_RESP,e)},t}(BaseProxy);egret.registerClass(LoginProxy,"LoginProxy");var LoginView=function(e){function t(t,n){e.call(this,t,n),App.DeviceUtils.IsMobile?this.skinName="resource/skins/vmobile/LoginViewMSkin.exml":this.skinName="resource/skins/LoginSkin.exml"}__extends(t,e);var n=(__define,t),i=n.prototype;return i.initUI=function(){e.prototype.initUI.call(this),this.openIdInput.text="default_openid_"+egret.Capabilities.os,this.nickInput.text="nick"+Math.floor(100*Math.random()),this.enterBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onLogin,this)},i.initData=function(){e.prototype.initData.call(this)},i.open=function(){for(var t=[],n=0;n<arguments.length;n++)t[n-0]=arguments[n];e.prototype.open.call(this,t),RoomManager.hasRoomInfo&&(this.roomIdInput.text=RoomManager.roomId)},i.close=function(){for(var t=[],n=0;n<arguments.length;n++)t[n-0]=arguments[n];e.prototype.close.call(this,t)},i.onLogin=function(){RoomManager.roomId=this.roomIdInput.text;var e=this.openIdInput.text;e=""==e||null==e?"default_openid"+egret.Capabilities.os:e;var t=this.nickInput.text;t=""==t||null==t?"nick"+Math.floor(100*Math.random()):t;var n="1";this.applyFunc(LoginConst.LOGIN_REQ,e,n,t)},i.loginSuccess=function(){App.TipsUtils.showCenter("登录成功")},t}(BaseEuiView);egret.registerClass(LoginView,"LoginView");var ReplyDismissController=function(e){function t(){e.call(this),this.replyView=new ReplyDismissPanel(this,LayerManager.UI_Popup),App.ViewManager.register(ViewConst.ReplyDismiss,this.replyView),this.proxy=new ReplyDismissProxy(this),this.registerFunc(RoomConst.ROOM_REPLY_DISMISS_REQ,this.onReq,this),this.registerFunc(RoomConst.ROOM_REPLY_DISMISS_RESP,this.onResp,this)}__extends(t,e);var n=(__define,t),i=n.prototype;return i.onReq=function(e){this.proxy.replyDismiss(e)},i.onResp=function(e){App.TipsUtils.showCenter("reply dismiss room resp")},t}(BaseController);egret.registerClass(ReplyDismissController,"ReplyDismissController");var ReplyDismissPanel=function(e){function t(t,n){e.call(this,t,n),this.icon="table_shop"}__extends(t,e);var n=(__define,t),i=n.prototype;return i.initData=function(){e.prototype.initData.call(this),this.height=200,this._tipsLbl=new eui.Label,this.contentGroup.addChild(this._tipsLbl),this._tipsLbl.x=10,this._tipsLbl.y=10,this._tipsLbl.width=400,this._tipsLbl.text="解除房间？",this._agreeBtn=new eui.Button,this._agreeBtn.skinName="skins.ButtonSkin",this.contentGroup.addChild(this._agreeBtn),this._agreeBtn.width=100,this._agreeBtn.label="同意",this._agreeBtn.x=.5*(this.width-this._agreeBtn.width)-50-this._agreeBtn.width,this._agreeBtn.y=this.height-30,this._disagreeBtn=new eui.Button,this._disagreeBtn.skinName="skins.ButtonSkin",this.contentGroup.addChild(this._disagreeBtn),this._disagreeBtn.width=100,this._disagreeBtn.label="不同意",this._disagreeBtn.x=.5*(this.width-this._disagreeBtn.width)+50,this._disagreeBtn.y=this.height-30,this._agreeBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.agreeClickHandler,this),this._disagreeBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.disagreeClickHandler,this)},i.open=function(){for(var t=[],n=0;n<arguments.length;n++)t[n-0]=arguments[n];e.prototype.open.call(this,t),RoomManager.hasRoomInfo},i.agreeClickHandler=function(e){this.applyFunc(RoomConst.ROOM_REPLY_DISMISS_REQ,!0)},i.disagreeClickHandler=function(e){this.applyFunc(RoomConst.ROOM_REPLY_DISMISS_REQ,!1)},t}(BasePanelView);egret.registerClass(ReplyDismissPanel,"ReplyDismissPanel");var ReplyDismissProxy=function(e){function t(t){e.call(this,t),this.receiveServerMsg(Cmd.ROOM_REPLY_DISMISS,this.replyDismissRoomSuccess,this)}__extends(t,e);var n=(__define,t),i=n.prototype;return i.replyDismiss=function(e){var t={head:App.Head,agree:e};this.writeAndFlush(Cmd.ROOM_REPLY_DISMISS,t)},i.replyDismissRoomSuccess=function(e){this.applyFunc(RoomConst.ROOM_REPLY_DISMISS_RESP,e)},t}(BaseProxy);egret.registerClass(ReplyDismissProxy,"ReplyDismissProxy");var RoomConst=function(){function e(){}var t=(__define,e);t.prototype;return e.ROOM_ENTER_REQ="room.enter.room.req",e.ROOM_ENTER_RESP="room.enter.room.resp",e.ROOM_LEAVE_REQ="room.leave.room.req",e.ROOM_LEAVE_RESP="room.leave.room.resp",e.ROOM_PLAYERS_GET_REQ="room.get.players.room.req",e.ROOM_PLAYERS_GET_RESP="room.get.players.room.resp",e.ROOM_DISMISS_REQ="room.dismiss.room.req",e.ROOM_DISMISS_RESP="room.dismiss.room.resp",e.ROOM_ASK_DISMISS_REQ="room.ask.dismiss.room.req",e.ROOM_ASK_DISMISS_RESP="room.ask.dismiss.room.resp",e.ROOM_REPLY_DISMISS_REQ="room.reply.dismiss.room.req",e.ROOM_REPLY_DISMISS_RESP="room.reply.dismiss.room.resp",e.ROOM_PUKE_GET_REQ="room.puke.get.req",e.ROOM_PUKE_STOP_REQ="room.puke.stop.req",e.NOTIFY="room.notify",e}();egret.registerClass(RoomConst,"RoomConst");var RoomController=function(e){function t(){e.call(this),this.totalPoints=0,this.proxy=new RoomProxy(this),this.roomView=new RoomView(this,LayerManager.Room_Main),App.ViewManager.register(ViewConst.Room,this.roomView),this.roomUIView=new RoomUIView(this,LayerManager.Room_Main),App.ViewManager.register(ViewConst.RoomUI,this.roomUIView),this.registerFunc(RoomConst.NOTIFY,this.notify,this),App.MessageCenter.addListener(NotifyConst.PLAYER_ENTER,this.onPlayersChange,this),App.MessageCenter.addListener(NotifyConst.PLAYER_LEAVE,this.onPlayersChange,this),App.MessageCenter.addListener(NotifyConst.ROOM_START,this.onRoomStart,this)}__extends(t,e);var n=(__define,t),i=n.prototype;return i.addEvents=function(){this.registerFunc(RoomConst.ROOM_DISMISS_REQ,this.onDismiss,this),this.registerFunc(RoomConst.ROOM_ASK_DISMISS_REQ,this.onAskDismiss,this),this.registerFunc(RoomConst.ROOM_LEAVE_REQ,this.onLeave,this),this.registerFunc(RoomConst.ROOM_PLAYERS_GET_REQ,this.getPlayers,this),this.registerFunc(RoomConst.ROOM_DISMISS_RESP,this.dismissResp,this),this.registerFunc(RoomConst.ROOM_ASK_DISMISS_RESP,this.askDismissResp,this),this.registerFunc(RoomConst.ROOM_LEAVE_RESP,this.leaveResp,this),this.registerFunc(RoomConst.ROOM_PLAYERS_GET_RESP,this.onGetPlayersResp,this),this.registerFunc(RoomConst.ROOM_PUKE_GET_REQ,this.getPuke,this),this.totalPoints=0},i.removeEvents=function(){this.removeFunc(RoomConst.ROOM_DISMISS_REQ),this.removeFunc(RoomConst.ROOM_ASK_DISMISS_REQ),this.removeFunc(RoomConst.ROOM_LEAVE_REQ),this.removeFunc(RoomConst.ROOM_PLAYERS_GET_REQ),this.removeFunc(RoomConst.ROOM_DISMISS_RESP),this.removeFunc(RoomConst.ROOM_ASK_DISMISS_RESP),this.removeFunc(RoomConst.ROOM_LEAVE_RESP),this.removeFunc(RoomConst.ROOM_PLAYERS_GET_RESP),this.removeFunc(RoomConst.ROOM_PUKE_GET_REQ)},i.onDismiss=function(){this.proxy.dismissRoom()},i.onAskDismiss=function(){this.proxy.askDismissRoom()},i.onLeave=function(){this.proxy.leaveRoom()},i.dismissResp=function(){App.TipsUtils.showCenter("解散房间"),App.SceneManager.runScene(SceneConsts.Home)},i.askDismissResp=function(e){App.TipsUtils.showCenter("发起解散,剩余时间:"+e)},i.getPlayers=function(){this.proxy.getRoomPlayersInfo(RoomManager.playerIds)},i.leaveResp=function(e){App.TipsUtils.showCenter("离开房间"),App.SceneManager.runScene(SceneConsts.Home)},i.onGetPlayersResp=function(e){RoomManager.parsePlayers(e.playerInfo,"room"),this.roomUIView.refreshView(),this.roomView.refreshView(PukeManager.random(13))},i.notify=function(e){e.type==NotifyType.PLAYER_ENTER&&RoomManager.addPlayer(e.player_enter.enterer)},i.onPlayersChange=function(e){this.roomUIView.refreshView()},i.onRoomStart=function(e){App.TipsUtils.showCenter("牌局开始"),App.SceneManager.getCurrScene!=SceneConsts.Room.valueOf&&App.SceneManager.runScene(SceneConsts.Room)},i.getPuke=function(e){var t=this.roomView.getOnePuke();this.totalPoints+=t.points,this.totalPoints>10.5?this.roomUIView.state=GamingStates.BOOM:App.TipsUtils.showCenter("当前点数："+this.totalPoints),this.roomView.pukeCount>=PukeBar.PUKE_MAX_COUNT&&(this.roomUIView.state=GamingStates.SETTLEMENT,this.roomUIView.curtPoints=this.totalPoints)},t}(BaseController);egret.registerClass(RoomController,"RoomController");var RoomProxy=function(e){function t(t){e.call(this,t),this.receiveServerMsg(Cmd.ROOM_DISMISS,this.dismissRoomSuccess,this),this.receiveServerMsg(Cmd.ROOM_ASK_DISMISS,this.askDismissSuccess,this),this.receiveServerMsg(Cmd.ROOM_LEAVE,this.leaveRoomSuccess,this),this.receiveServerMsg(Cmd.ROOM_PLAYER_INFO_GET,this.getRoomPlayersInfoSuccess,this)}__extends(t,e);var n=(__define,t),i=n.prototype;return i.dismissRoom=function(){var e={head:App.Head};this.writeAndFlush(Cmd.ROOM_DISMISS,e)},i.askDismissRoom=function(){var e={head:App.Head};this.writeAndFlush(Cmd.ROOM_ASK_DISMISS,e)},i.leaveRoom=function(){var e={head:App.Head};this.writeAndFlush(Cmd.ROOM_LEAVE,e)},i.getRoomPlayersInfo=function(e){var t={head:App.Head,uid:e};this.writeAndFlush(Cmd.ROOM_PLAYER_INFO_GET,t)},i.dismissRoomSuccess=function(e){RoomManager.clearRoomInfo(),this.applyFunc(RoomConst.ROOM_DISMISS_RESP,e)},i.askDismissSuccess=function(e){this.applyFunc(RoomConst.ROOM_ASK_DISMISS_RESP,e.waitSeconds)},i.leaveRoomSuccess=function(e){this.applyFunc(RoomConst.ROOM_LEAVE_RESP,e)},i.getRoomPlayersInfoSuccess=function(e){this.applyFunc(RoomConst.ROOM_PLAYERS_GET_RESP,e)},t}(BaseProxy);egret.registerClass(RoomProxy,"RoomProxy");var RoomUIView=function(e){function t(t,n){e.call(this,t,n),this._state=GamingStates.NONE,App.DeviceUtils.IsMobile?this.skinName="resource/skins/vmobile/RoomViewMSkin.exml":this.skinName="resource/skins/RoomUISkin.exml"}__extends(t,e);var n=__define,i=t,r=i.prototype;return r.initUI=function(){e.prototype.initUI.call(this),this.dismissBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.dismissBtnClickHandler,this),this.leaveBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.leaveClickHandler,this),this.sendBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.sendClickHandler,this),this.refreshBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.refreshClickHandler,this),this.inviteBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.inviteClickHandler,this),App.DeviceUtils.IsMobile||(this.readyBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.readyClickHandler,this),this.bettingBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.bettingClickHandler,this),this.getBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.getClickHandler,this),this.stopBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.stopClickHandler,this))},r.open=function(){for(var t=[],n=0;n<arguments.length;n++)t[n-0]=arguments[n];e.prototype.open.call(this,t),this.state=GamingStates.NONE,this.refreshView()},r.dismissBtnClickHandler=function(e){this.applyFunc(RoomConst.ROOM_ASK_DISMISS_REQ)},r.leaveClickHandler=function(e){this.applyFunc(RoomConst.ROOM_LEAVE_REQ)},r.sendClickHandler=function(e){""!=this.msgInput.text&&null!=this.msgInput.text&&App.TipsUtils.showCenter(this.msgInput.text)},r.refreshClickHandler=function(e){this.applyFunc(RoomConst.ROOM_PLAYERS_GET_REQ,RoomManager.playerIds)},r.inviteClickHandler=function(e){Log.trace("invite"),WeixinApi.ready(function(e){App.TipsUtils.showCenter("WeixinAPI ready");var t=new WeixinShareInfo;t.title="HelloEgret",t.desc="欢迎使用Egret",t.link="www.egret-labs.org",e.shareToFriend(t),e.shareToTimeline(t)})},r.refreshView=function(){this.state=GamingStates.WAITING;var e,t=RoomManager.players;this.revert();for(var n=0;n<t.length;n++)switch(e=t[n],e.seatid){case 0:this.topPlayerLabel.text=e.nick;break;case 1:this.leftPlayerLabel.text=e.nick;break;case 2:this.bottomPlayerLabel.text=e.nick;break;case 3:this.rightPlayerLabel.text=e.nick;break;default:this.rightPlayerLabel.text="无座位:"+e.nick+" s:"+e.seatid}RoomManager.hasRoomInfo?this.roomLabel.text="房间号："+RoomManager.roomId:this.roomLabel.text="房间"},r.revert=function(){this.topPlayerLabel.text="0",this.leftPlayerLabel.text="1",this.bottomPlayerLabel.text="2",this.rightPlayerLabel.text="3"},n(r,"curtPoints",void 0,function(e){this.stateLbl.text="当前点数："+e}),r.readyClickHandler=function(e){this.state=GamingStates.READY_GET},r.bettingClickHandler=function(e){this.state=GamingStates.BETTING},r.getClickHandler=function(e){this.applyFunc(RoomConst.ROOM_PUKE_GET_REQ)},r.stopClickHandler=function(e){this.state=GamingStates.STOP},n(r,"state",void 0,function(e){switch(this._state=e,this.readyBtn.enabled=this.bettingBtn.enabled=this.getBtn.enabled=this.stopBtn.enabled=!1,this._state){case GamingStates.NONE:this.stateLbl.text="游客";break;case GamingStates.WAITING:this.readyBtn.enabled=!0,this.stateLbl.text="等待中",App.TipsUtils.showCenter("等待中");break;case GamingStates.READY_GET:this.bettingBtn.enabled=!0,this.stateLbl.text="已准备",App.TipsUtils.showCenter("已准备");break;case GamingStates.BETTING:this.getBtn.enabled=!0,this.stopBtn.enabled=!0,this.stateLbl.text="已下注",App.TipsUtils.showCenter("已下注");break;case GamingStates.GETTING:break;case GamingStates.GAMING:this.bettingBtn.enabled=!0;break;case GamingStates.BOOM:this.stateLbl.text="已爆牌",App.TipsUtils.showCenter("已爆牌");break;case GamingStates.STOP:this.stateLbl.text="已停牌",App.TipsUtils.showCenter("已停牌");break;case GamingStates.SETTLEMENT:this.stateLbl.text="结算中",App.TipsUtils.showCenter("结算中");break;case GamingStates.END:this.stateLbl.text="此局结束",App.TipsUtils.showCenter("此局结束")}}),t}(BaseEuiView);egret.registerClass(RoomUIView,"RoomUIView");var RoomView=function(e){function t(t,n){e.call(this,t,n),this._pukes=new Array,this.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClickItem,this)}__extends(t,e);var n=__define,i=t,r=i.prototype;return r.initUI=function(){e.prototype.initUI.call(this),this.bbar=new PukeBar,this.bbar.x=(App.StageUtils.getWidth()-5*PukeBar.ITEM_STACKED_WIDTH)/2,this.bbar.y=App.StageUtils.getHeight()-290,this.addChild(this.bbar)},r.open=function(){for(var t=[],n=0;n<arguments.length;n++)t[n-0]=arguments[n];e.prototype.open.call(this,t),this.refreshView([])},r.refreshView=function(e){this.bbar.data=e},r.getOnePuke=function(){var e=PukeManager.randomOne(this._pukes.length);return this.bbar.addItem(e),e},n(r,"pukeCount",function(){return this.bbar.pukeCount}),r.onClickItem=function(e){e.target instanceof PukeItem&&this.bbar.switchItem(e.target)},t}(BaseEuiView);egret.registerClass(RoomView,"RoomView");var RoomEnterController=function(e){function t(){e.call(this),this.enterView=new RoomEnterPanel(this,LayerManager.UI_Popup),App.ViewManager.register(ViewConst.RoomEnter,this.enterView),this.proxy=new RoomEnterProxy(this),this.registerFunc(HomeConst.ROOM_ENTER_REQ,this.onEnter,this),this.registerFunc(HomeConst.ROOM_ENTER_RESP,this.enterResp,this)}__extends(t,e);var n=(__define,t),i=n.prototype;return i.onEnter=function(e){RoomManager.roomId=e,this.proxy.enterRoom(e)},i.enterResp=function(e){RoomManager.parsePlayers(e.players,"room enter"),App.SceneManager.runScene(SceneConsts.Room)},t}(BaseController);egret.registerClass(RoomEnterController,"RoomEnterController");var RoomEnterPanel=function(e){function t(t,n){e.call(this,t,n),this.icon="table_shop"}__extends(t,e);var n=(__define,t),i=n.prototype;return i.initData=function(){e.prototype.initData.call(this),this.height=200,this._roomIdInput=new eui.TextInput,this._roomIdInput.skinName="skins.TextInputSkin",this._roomIdInput.prompt="输入房间号",this.contentGroup.addChild(this._roomIdInput),this._roomIdInput.x=10,this._roomIdInput.y=10,this._roomIdInput.width=400,this._enterBtn=new eui.Button,this._enterBtn.skinName="skins.ButtonSkin",this.contentGroup.addChild(this._enterBtn),this._enterBtn.width=200,this._enterBtn.label="进入",this._enterBtn.x=.5*(this.width-this._enterBtn.width),this._enterBtn.y=this.height-30,this._enterBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.enterClickHandler,this)},i.open=function(){for(var t=[],n=0;n<arguments.length;n++)t[n-0]=arguments[n];e.prototype.open.call(this,t),RoomManager.hasRoomInfo&&(this._roomIdInput.text=RoomManager.roomId)},i.enterClickHandler=function(e){var t=this._roomIdInput.text;return null==t||""==t?void App.TipsUtils.showCenter("请输入房间号"):void this.applyFunc(HomeConst.ROOM_ENTER_REQ,t)},t}(BasePanelView);egret.registerClass(RoomEnterPanel,"RoomEnterPanel");var RoomEnterProxy=function(e){function t(t){e.call(this,t),this.receiveServerMsg(Cmd.ROOM_ENTER,this.enterRoomSuccess,this)}__extends(t,e);var n=(__define,t),i=n.prototype;return i.enterRoom=function(e){var t={head:App.Head,ob:RoomManager.isOb,roomid:e};this.writeAndFlush(Cmd.ROOM_ENTER,t)},i.enterRoomSuccess=function(e){this.applyFunc(HomeConst.ROOM_ENTER_RESP,e)},t}(BaseProxy);egret.registerClass(RoomEnterProxy,"RoomEnterProxy");var ServerChooseController=function(e){function t(){e.call(this),this.chooseView=new ServerChooseView(this,LayerManager.UI_Main),App.ViewManager.register(ViewConst.ServerChoose,this.chooseView)}__extends(t,e);var n=(__define,t);n.prototype;return t}(BaseController);egret.registerClass(ServerChooseController,"ServerChooseController");var ServerChooseView=function(e){function t(t,n){e.call(this,t,n),this.skinName="resource/skins/ServerChooseSkin.exml"}__extends(t,e);var n=(__define,t),i=n.prototype;return i.initUI=function(){e.prototype.initUI.call(this),this.serverList.itemRenderer=ServerItemRenderer,this.serverList.addEventListener(egret.TouchEvent.TOUCH_TAP,this.listItemClickHandler,this)},i.listItemClickHandler=function(e){Log.trace("list:",this.serverList.selectedItem);var t=this.serverList.selectedItem;void 0!=t&&null!=t&&(App.Socket.initServer(t.ip,t.port,new ByteArrayMsgByProtobuf),App.Socket.connect(),App.MessageCenter.addListener(SocketConst.SOCKET_CONNECT,function(){Log.trace("[Startup]与服务器连接上"),App.ViewManager.close(ViewConst.ServerChoose),0==t.seletedIdex?App.ViewManager.open(ViewConst.Home):App.ViewManager.open(ViewConst.Login)},this),App.MessageCenter.addListener(SocketConst.SOCKET_RECONNECT,function(){Log.trace("[Startup]与服务器重新连接上")},this),App.MessageCenter.addListener(SocketConst.SOCKET_START_RECONNECT,function(){Log.trace("[Startup]开始与服务器重新连接")},this),App.MessageCenter.addListener(SocketConst.SOCKET_CLOSE,function(){Log.trace("[Startup]与服务器断开连接")},this),App.MessageCenter.addListener(SocketConst.SOCKET_NOCONNECT,function(){Log.trace("[Startup]服务器连接不上")},this),App.MessageCenter.addListener("10001",function(e){Log.trace("[Startup]收到服务器消息:",e)},this))},t}(BaseEuiView);egret.registerClass(ServerChooseView,"ServerChooseView");var ServerItemRenderer=function(e){function t(){e.call(this),this.skinName="resource/skins/ServerItemRendererSkin.exml",this.touchChildren=!0}__extends(t,e);var n=(__define,t),i=n.prototype;return i.dataChanged=function(){this.nameLbl.text=this.data.label,this.ipLbl.text=this.data.ip,this.portLbl.text=this.data.port},t}(eui.ItemRenderer);egret.registerClass(ServerItemRenderer,"ServerItemRenderer");var CenterTips=function(){function e(){this._status=0,this._container=new egret.Sprite,this._txt=new egret.TextField,this._txt.x=this._txt.y=10,this._txt.textColor=16777215,this._txt.textAlign=egret.HorizontalAlign.CENTER,this._container.addChild(this._txt)}var t=(__define,e),n=t.prototype;return n.getStatus=function(){return this._status},n.show=function(e,t,n,i){if(null!=t){this._status=1,this._txt.text=e;var r=this._txt.width,s=this._txt.height;this._container.alpha=1,this._container.graphics.clear(),this._container.graphics.beginFill(0,.5),this._container.graphics.drawRoundRect(0,0,r+20,s+20,5,5),this._container.graphics.endFill(),this._container.x=.5*(t.width-this._container.width),this._container.y=.5*(t.height-this._container.height),t.addChild(this._container),n&&this.hide(i)}else Log.error("parent should not be null")},n.hide=function(e){var t=(this._container.y,Math.max(this._container.y-Math.floor(100*Math.random())-40,0)),n=egret.Tween.get(this._container);n.to({y:t},1e3).call(function(){}).wait(2).to({alpha:.5},1e3).call(function(){App.DisplayUtils.removeFromParent(this)}),egret.setTimeout(function(e){e()},this,3e3,this.reset)},n.reset=function(){this._status=0},e}();egret.registerClass(CenterTips,"CenterTips",["BaseTips"]);var TipsController=function(){function e(){}var t=(__define,e);t.prototype;return e}();egret.registerClass(TipsController,"TipsController");var BasePukeItem=function(e){function t(){e.call(this)}__extends(t,e);var n=(__define,t);n.prototype;return t}(eui.Component);egret.registerClass(BasePukeItem,"BasePukeItem");var PukeBar=function(e){function t(){e.call(this),this._infos=new Array,this._items=new Array}__extends(t,e);var n=__define,i=t,r=i.prototype;return n(r,"data",void 0,function(e){this._infos=e,this.render()}),n(r,"pukeCount",function(){return this._infos.length}),r.addItem=function(e){if(this._infos.length>=t.PUKE_MAX_COUNT)return void App.TipsUtils.showCenter("最多为"+t.PUKE_MAX_COUNT+"张");this._infos.push(e);var n=new PukeItem;n.info=e,this.addChild(n),egret.Tween.get(n).to({x:t.ITEM_STACKED_WIDTH*this._infos.length},500)},r.switchItem=function(e){null==this._curtItem?(this._curtItem=e,this._curtItem.switchMove()):(this._curtItem!=e&&this._curtItem.revertPos(),this._curtItem=e,this._curtItem.switchMove())},r.render=function(){this.removeAllChildren();var e,n=this._infos.length;this._infos.sort(this.sortFun);for(var i=0;n>i;i++)i>this._items.length-1&&(e=new PukeItem,this._items.push(e)),e=this._items[i],e.info=this._infos[i],this.addChild(e),egret.Tween.get(e).to({x:t.ITEM_STACKED_WIDTH*i},1e3)},r.sortFun=function(e,t){return e.pid==t.pid?0:e.pid>t.pid?1:-1},r.removeAllChildren=function(){for(;this.numChildren>0;){var e=this.removeChildAt(0);e.x=0,e.y=0}},t.ITEM_WIDTH=100,t.ITEM_HEIGHT=120,t.ITEM_STACKED_WIDTH=60,t.PUKE_MAX_COUNT=5,t}(eui.Component);egret.registerClass(PukeBar,"PukeBar");var PukeItem=function(e){function t(){e.call(this),this._status=0,this._status=0,this._img=new egret.Bitmap,this.addChild(this._img),this._img.width=PukeBar.ITEM_WIDTH,this._img.height=PukeBar.ITEM_HEIGHT}__extends(t,e);var n=__define,i=t,r=i.prototype;return n(r,"info",void 0,function(e){this._info=e,this.refresh()}),r.switchMove=function(){egret.Tween.removeTweens(this),0==this._status?(this._status=1,egret.Tween.get(this).to({y:-20},300)):(this._status=0,egret.Tween.get(this).to({y:0},300))},r.revertPos=function(){egret.Tween.get(this).to({y:0},300)},r.discard=function(){},r.refresh=function(){null!=this._info&&(this._img.texture=RES.getRes("puke"+this._info.pid))},t}(BasePukeItem);egret.registerClass(PukeItem,"PukeItem");var BaseScene=function(){function e(){this._layers=new Array}var t=(__define,e),n=t.prototype;return n.onEnter=function(){},n.onExit=function(){App.ViewManager.closeAll(),this.removeAllLayer()},n.addLayer=function(e){e instanceof BaseSpriteLayer?(App.StageUtils.getStage().addChild(e),this._layers.push(e)):e instanceof BaseEuiLayer&&(App.StageUtils.getUIStage().addChild(e),this._layers.push(e))},n.addLayerAt=function(e,t){e instanceof BaseSpriteLayer?(App.StageUtils.getStage().addChildAt(e,t),this._layers.push(e)):e instanceof BaseEuiLayer&&(App.StageUtils.getUIStage().addChildAt(e,t),this._layers.push(e))},n.removeLayer=function(e){e instanceof BaseSpriteLayer?(App.StageUtils.getStage().removeChild(e),this._layers.splice(this._layers.indexOf(e),1)):e instanceof BaseEuiLayer&&(App.StageUtils.getUIStage().removeChild(e),this._layers.splice(this._layers.indexOf(e),1))},n.layerRemoveAllChild=function(e){e instanceof BaseSpriteLayer?e.removeChildren():e instanceof BaseEuiLayer&&e.removeChildren()},n.removeAllLayer=function(){for(;this._layers.length;){var e=this._layers[0];this.layerRemoveAllChild(e),this.removeLayer(e)}},e}();egret.registerClass(BaseScene,"BaseScene");var EnterScene=function(e){function t(){e.call(this)}__extends(t,e);var n=(__define,t),i=n.prototype;return i.onEnter=function(){e.prototype.onEnter.call(this),this.addLayer(LayerManager.UI_Main),this.addLayer(LayerManager.UI_Popup),this.addLayer(LayerManager.UI_Message),this.addLayer(LayerManager.UI_Tips);var t=new eui.Rect;t.fillColor=13421772,t.percentHeight=100,t.percentWidth=100,LayerManager.UI_Main.addChild(t),App.ViewManager.open(ViewConst.ServerChoose),App.SoundManager.playBg("sound_bg")},i.onExit=function(){e.prototype.onExit.call(this)},t}(BaseScene);egret.registerClass(EnterScene,"EnterScene");var HomeScene=function(e){function t(){e.call(this)}__extends(t,e);var n=(__define,t),i=n.prototype;return i.onEnter=function(){e.prototype.onEnter.call(this),this.addLayer(LayerManager.UI_Main),this.addLayer(LayerManager.UI_Popup),this.addLayer(LayerManager.UI_Message),this.addLayer(LayerManager.UI_Tips);var t=new eui.Rect;t.fillColor=7911743,t.percentHeight=100,t.percentWidth=100,LayerManager.UI_Main.addChild(t),App.ViewManager.open(ViewConst.Home),App.SoundManager.playBg("sound_bg")},i.onExit=function(){e.prototype.onExit.call(this)},t}(BaseScene);egret.registerClass(HomeScene,"HomeScene");var BaseSpriteLayer=function(e){function t(){e.call(this),this.touchEnabled=!1}__extends(t,e);var n=(__define,t);n.prototype;return t}(egret.DisplayObjectContainer);egret.registerClass(BaseSpriteLayer,"BaseSpriteLayer");var BaseEuiLayer=function(e){function t(){e.call(this),this.percentWidth=100,this.percentHeight=100,this.touchEnabled=!1}__extends(t,e);var n=(__define,t);n.prototype;return t}(eui.Group);egret.registerClass(BaseEuiLayer,"BaseEuiLayer");var LayerManager=function(){function e(){}var t=(__define,e);t.prototype;return e.Game_Bg=new BaseSpriteLayer,e.Room_Main=new BaseEuiLayer,e.UI_Main=new BaseEuiLayer,e.UI_Popup=new BaseEuiLayer,e.UI_Message=new BaseEuiLayer,e.UI_Tips=new BaseEuiLayer,e}();egret.registerClass(LayerManager,"LayerManager");var LoadingScene=function(e){function t(){e.call(this)}__extends(t,e);var n=(__define,t),i=n.prototype;return i.onEnter=function(){e.prototype.onEnter.call(this),this.addLayer(LayerManager.UI_Main),App.ViewManager.open(ViewConst.Loading)},i.onExit=function(){e.prototype.onExit.call(this)},t}(BaseScene);egret.registerClass(LoadingScene,"LoadingScene");var RoomScene=function(e){function t(){e.call(this)}__extends(t,e);var n=(__define,t),i=n.prototype;return i.onEnter=function(){e.prototype.onEnter.call(this),this.addLayerAt(LayerManager.Room_Main,0),this.addLayer(LayerManager.UI_Tips),App.ViewManager.open(ViewConst.RoomUI),App.ViewManager.open(ViewConst.Room),App.SoundManager.playBg("sound_bg")},i.onExit=function(){e.prototype.onExit.call(this)},t}(BaseScene);egret.registerClass(RoomScene,"RoomScene");var App=function(){function e(){}var t=__define,n=e;n.prototype;return e.Init=function(){e.GlobalData=RES.getRes("global"),e.DebugUtils.isOpen(e.GlobalData.IsDebug),e.DebugUtils.setThreshold(5),e.Http.initServer(e.GlobalData.HttpSerever),protobuf.load("../resource/proto/package.proto",ProtoManager.getProtoContents(),null,function(t,n){e.ProtoRoot=n}),e.ReqConfig=RES.getRes(e.GlobalData.ReqConfig),e.RespConfig=RES.getRes(e.GlobalData.RespConfig),e.Socket.initServer(e.GlobalData.SocketServer,e.GlobalData.SocketPort,new ByteArrayMsgByProtobuf)},e.lookupProtoMessage=function(t){return e.ProtoRoot.lookup(t)},t(e,"Head",function(){return null==this._head&&(this._head=e.lookupProtoMessage(Msg.Head).create({uid:12,err:0,errmsg:""})),this._head}),t(e,"Http",function(){return Http.getInstance()}),t(e,"Socket",function(){return Socket.getInstance()}),t(e,"EasyLoading",function(){return EasyLoading.getInstance()}),t(e,"ResVersionManager",function(){return ResVersionManager.getInstance()}),t(e,"DebugUtils",function(){return DebugUtils.getInstance()}),t(e,"MessageCenter",function(){return MessageCenter.getInstance(0)}),t(e,"TimerManager",function(){return TimerManager.getInstance()}),t(e,"DeviceUtils",function(){return DeviceUtils.getInstance()}),t(e,"DisplayUtils",function(){return DisplayUtils.getInstance()}),t(e,"StageUtils",function(){return StageUtils.getInstance()}),t(e,"ResourceUtils",function(){return ResourceUtils.getInstance()}),t(e,"SoundManager",function(){return SoundManager.getInstance()}),t(e,"ControllerManager",function(){return CtrlManager.getInstance()}),t(e,"ViewManager",function(){return ViewManager.getInstance()}),t(e,"SceneManager",function(){return SceneManager.getInstance()}),t(e,"TipsUtils",function(){return TipsUtils.getInstance()}),e.ProxyUserFlag="",e.GlobalData=null,e.ProtoFile=null,e.ProtoConfig=null,e}();egret.registerClass(App,"App");var AssetAdapter=function(){function e(){}var t=(__define,e),n=t.prototype;return n.getAsset=function(e,t,n){function i(i){t.call(n,i,e)}if(RES.hasRes(e)){var r=RES.getRes(e);r?i(r):RES.getResAsync(e,i,this)}else RES.getResByUrl(e,i,this,RES.ResourceItem.TYPE_IMAGE)},e}();egret.registerClass(AssetAdapter,"AssetAdapter",["eui.IAssetAdapter"]);var ThemeAdapter=function(){function e(){}var t=(__define,e),n=t.prototype;return n.getTheme=function(e,t,n,i){function r(e){t.call(i,e)}function s(t){t.resItem.url==e&&(RES.removeEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,s,null),n.call(i))}RES.addEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,s,null),RES.getResByUrl(e,r,this,RES.ResourceItem.TYPE_TEXT)},e}();egret.registerClass(ThemeAdapter,"ThemeAdapter",["eui.IThemeAdapter"]);var CtrlManager=function(e){function t(){e.call(this),this._modules={}}__extends(t,e);var n=(__define,t),i=n.prototype;return i.clear=function(){this._modules={}},i.register=function(e,t){this.isExists(e)||(this._modules[e]=t)},i.unregister=function(e){this.isExists(e)&&(this._modules[e]=null,delete this._modules[e])},i.isExists=function(e){return null!=this._modules[e]},i.applyFunc=function(e,t){for(var n=[],i=2;i<arguments.length;i++)n[i-2]=arguments[i];var r=this._modules[e];if(r){for(var s=[],o=1;o<arguments.length;o++)s[o-1]=arguments[o];return r.applyFunc.apply(r,s)}return Log.trace("模块"+e+"不存在"),null},i.getControllerModel=function(e){var t=this._modules[e];return t?t.getModel():null},t}(BaseClass);egret.registerClass(CtrlManager,"CtrlManager");var ViewManager=function(e){function t(){e.call(this),this._views={},this._opens=[]}__extends(t,e);var n=(__define,t),i=n.prototype;return i.clear=function(){this.closeAll(),this._views={}},i.register=function(e,t){null!=t&&(this._views[e]||(this._views[e]=t))},i.unregister=function(e){this._views[e]&&(this._views[e]=null,delete this._views[e])},i.destroy=function(e,t){void 0===t&&(t=null);var n=this.getView(e);n&&(this.unregister(e),n.destroy(),n=null),this.register(e,t)},i.open=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];var i=this.getView(e);return null==i?void Log.trace("UI_"+e+"不存在"):i.isShow()?(i.open.apply(i,t),i):(i.isInit()?(i.addToParent(),i.open.apply(i,t)):(App.EasyLoading.showLoading(),i.loadResource(function(){i.addToParent(),i.setVisible(!1)}.bind(this),function(){i.initUI(),i.initData(),i.open.apply(i,t),i.setVisible(!0),App.EasyLoading.hideLoading()}.bind(this))),this._opens.push(e),i)},i.close=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];if(this.isShow(e)){var i=this.getView(e);if(null!=i){var r=this._opens.indexOf(e);e>=0&&this._opens.splice(r,1),i.removeFromParent(),i.close.apply(i,t)}}},i.closeView=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];for(var i=Object.keys(this._views),r=0,s=i.length;s>r;r++){var o=parseInt(i[r]);if(this._views[o]==e)return void this.close(o,t)}},i.getView=function(e){return this._views[e]},i.closeAll=function(){for(;this._opens.length;)this.close(this._opens[0])},i.currOpenNum=function(){return this._opens.length
},i.isShow=function(e){return-1!=this._opens.indexOf(e)},t}(BaseClass);egret.registerClass(ViewManager,"ViewManager");var BaseSpriteView=function(e){function t(t,n){e.call(this),this._resources=null,this._controller=t,this._myParent=n,this._isInit=!1,App.StageUtils.getStage().addEventListener(egret.Event.RESIZE,this.onResize,this)}__extends(t,e);var n=__define,i=t,r=i.prototype;return r.setResources=function(e){this._resources=e},n(r,"myParent",function(){return this._myParent}),r.isInit=function(){return this._isInit},r.applyFunc=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];return this._controller.applyFunc.apply(this._controller,arguments)},r.applyControllerFunc=function(e,t){for(var n=[],i=2;i<arguments.length;i++)n[i-2]=arguments[i];return this._controller.applyControllerFunc.apply(this._controller,arguments)},r.isShow=function(){return null!=this.stage&&this.visible},r.addToParent=function(){this._myParent.addChild(this)},r.removeFromParent=function(){App.DisplayUtils.removeFromParent(this)},r.initUI=function(){this._isInit=!0},r.initData=function(){},r.open=function(){for(var e=[],t=0;t<arguments.length;t++)e[t-0]=arguments[t];this._controller.addEvents()},r.close=function(){for(var e=[],t=0;t<arguments.length;t++)e[t-0]=arguments[t];this._controller.removeEvents()},r.destroy=function(){this._controller.destroy(),this._controller=null,this._myParent=null,this._resources=null},r.onResize=function(){},r.loadResource=function(e,t){this._resources&&this._resources.length>0?App.ResourceUtils.loadResource(this._resources,[],function(){e(),t()},null,this):(e(),t())},r.setVisible=function(e){this.visible=e},t}(egret.DisplayObjectContainer);egret.registerClass(BaseSpriteView,"BaseSpriteView",["IBaseView"]);var DynamicChange=function(){function e(){this._dataCache=[],this._pUpdate=new ProxyUpdate(this._dataCache)}var t=__define,n=e,i=n.prototype;return t(i,"pUpdate",function(){return this._pUpdate}),i.getCacheData=function(e){return this._dataCache[e]?this._dataCache[e]:null},i.clearCache=function(){for(var e=Object.keys(this._dataCache),t=0,n=e.length;n>t;t++){var i=e[t];this._dataCache[i]=null,delete this._dataCache[i]}},i.getCacheKeyInfos=function(){for(var e=[],t=Object.keys(this._dataCache),n=0,i=t.length;i>n;n++){var r=t[n],s=this._dataCache[r];e.push(s)}return e},i.isCache=function(e){return this._dataCache[e]},e}();egret.registerClass(DynamicChange,"DynamicChange");var ProxyUpdate=function(){function e(e){this._cache=e}var t=(__define,e),n=t.prototype;return n.isArray=function(e){return e instanceof Array},n.isObject=function(e){return e.indexOf("object")>-1},n.isNormal=function(e){var t=e.indexOf("@")>-1,n=e.indexOf(".")>-1,i=e.indexOf("_")>-1;return!t&&!n&&!i},n.isAddToArray=function(e){return"@a"==e},n.isRemoveToArray=function(e){var t=e.split("_");return t.length<=3&&"@d"==t[0]},n.isFilter=function(e){var t=e.split("_");return"@f"==t[0]},n.isNumeric=function(e){return parseFloat(e).toString()==e.toString()},n._updateObject=function(e,t,n){var i=e.split(".");"@a"==i[0]||"@s"==i[0]?n[i[1]]=t:"@d"==i[0]&&delete n[i[1]]},n._getFilterObject=function(e,t){if(t){var n=e.split("_");if(3==n.length&&"@f"==n[0]&&this.isArray(t))for(var i=n[1],r=n[2],s=0;s<t.length;s++){var o=t[s];if(3==n.length&&this.isObject(o.toString())){var a=o[i];if(a&&("@"==r[0]&&(r=r.replace("@","")),r==a))return o}}}return null},n._addObjectToArray=function(e,t){if(this.isArray(t))for(var n=0;n<t.length;n++)e.push(t[n]);else e.push(t)},n._removeObjectFromArray=function(e,t,n){var i=t.split("_");if(i.length<=3&&"@d"==i[0]&&this.isArray(e))for(var r=e.length,s=r-1;s>=0;s--){var o=e[s];if(3==i.length){if(o.hasOwnProperty(i[1])){var a=i[2];"@"==a[0]&&(a=a.replace("@","")),a==o[i[1]]&&e.splice(s,1)}}else 2==i.length&&o.hasOwnProperty(i[1])?n==o[i[1]]&&e.splice(s,1):1==i.length&&n==o&&e.splice(s,1)}},n.update=function(e,t){if(this._cache[e]=t,t.hasOwnProperty("c"))for(var n=t.c,i=Object.keys(n),r=0,s=i.length;s>r;r++){var o=i[r];this._cache[o]&&(this._update(this._cache[o],n[o]),App.MessageCenter.dispatch(o+"_HttpUpdate"))}},n._update=function(e,t){if(e&&t&&this.isObject(t.toString()))for(var n=Object.keys(t),i=0,r=n.length;r>i;i++){var s=n[i],o=t[s];if(this.isNormal(s)&&this.isObject(o.toString()))e.hasOwnProperty(s)&&this._update(e[s],o);else if(this.isNormal(s)&&this.isNumeric(o)){var a=e[s];e[s]=a+o}else if(this.isNormal(s))e[s]=o;else if(this.isAddToArray(s))this._addObjectToArray(e,o);else if(this.isRemoveToArray(s))this._removeObjectFromArray(e,s,o);else if(this.isFilter(s)){var u=this._getFilterObject(s,e);u&&this._update(u,o)}else this._updateObject(s,o,e)}},e}();egret.registerClass(ProxyUpdate,"ProxyUpdate");var Http=function(e){function t(){e.call(this),this._data=new DynamicChange,this._cache=[],this._request=new egret.URLRequest,this._request.method=egret.URLRequestMethod.POST,this._urlLoader=new egret.URLLoader,this._urlLoader.addEventListener(egret.IOErrorEvent.IO_ERROR,this.onError,this)}__extends(t,e);var n=__define,i=t,r=i.prototype;return r.initServer=function(e){this._serverUrl=e},n(r,"Data",function(){return this._data}),r.onError=function(e){this.nextPost()},r.send=function(e,t){this._cache.push([e,t]),this.post()},r.post=function(){if(!this._isRequesting&&0!=this._cache.length){var e=this._cache.shift(),t=e[0],n=e[1];this._type=t,this._request.url=this._serverUrl,this._request.data=n,this._urlLoader.addEventListener(egret.Event.COMPLETE,this.onLoaderComplete,this),this._urlLoader.load(this._request),this._isRequesting=!0}},r.onLoaderComplete=function(e){this._urlLoader.removeEventListener(egret.Event.COMPLETE,this.onLoaderComplete,this);var t=JSON.parse(this._urlLoader.data);t.hasOwnProperty("s")&&0!=t.s?Log.trace("Http错误:"+t.s):(this._data.pUpdate.update(this._type,t),App.MessageCenter.dispatch(this._type,t)),this.nextPost()},r.nextPost=function(){this._isRequesting=!1,this.post()},t}(BaseClass);egret.registerClass(Http,"Http");var ByteArrayMsg=function(){function e(){this._msgBuffer=new egret.ByteArray}var t=(__define,e),n=t.prototype;return n.receive=function(e){Log.trace("receive data"),e.readBytes(this._msgBuffer);var t=this.decode(this._msgBuffer);t&&App.MessageCenter.dispatch(t.key,t.body),0==this._msgBuffer.bytesAvailable&&this._msgBuffer.clear()},n.send=function(e,t){var n=this.encode(t);n&&(n.position=0,e.writeBytes(n,0,n.bytesAvailable))},n.writeAndFlush=function(e,t,n,i){var r=this.encode({cmd:t,body:i});r&&e.writeAndFlush(t,n,r)},n.decode=function(e){return Log.trace("decode需要子类重写，根据项目的协议结构解析"),null},n.encode=function(e){return Log.trace("encode需要子类重写，根据项目的协议结构解析"),null},e}();egret.registerClass(ByteArrayMsg,"ByteArrayMsg",["BaseMsg"]);var ByteArrayMsgByProtobuf=function(e){function t(){e.call(this),this.msgClass=null,this.reqConfig=null,this.respConfig=null,this.reqConfigSymmetry=null,this.respConfigSymmetry=null,this.msgClass=null,this.reqConfig=null,this.respConfig=null,this.reqConfigSymmetry=null,this.respConfigSymmetry=null,this.msgClass={},this.reqConfig=App.ReqConfig,this.respConfig=App.RespConfig,this.reqConfigSymmetry={},this.respConfigSymmetry={};for(var t=Object.keys(this.reqConfig),n=0,i=t.length;i>n;n++){var r=t[n],s=this.reqConfig[r];this.reqConfigSymmetry[r]=s}t=Object.keys(this.respConfig);for(var n=0,i=t.length;i>n;n++){var r=t[n],s=this.respConfig[r];this.respConfigSymmetry[r]=s}}__extends(t,e);var n=(__define,t),i=n.prototype;return i.getMessage=function(e){var t=this.msgClass[e];if((null==t||void 0==t)&&(t=App.lookupProtoMessage(e),this.msgClass[e]=t),null==t)throw new Error("不存在name="+e+"的Message");return t},i.getReqMsg=function(e){return this.reqConfig[e]},i.getRespMsg=function(e){return this.respConfig[e]},i.receive=function(e){var t=e.readHead(),n=e.readBody(),i=(t.readInt(),t.readInt()),r=(t.readByte(),{});r.cmd=i;var s=this.getMessage(this.getRespMsg(r.cmd));return r.body=s.decode(n),Log.trace("收到数据：","[cmd:"+r.cmd+"] ",r.body,r.body.head),void 0==r.body||void 0==r.body.head?void App.TipsUtils.showCenter("数据错误:"+this.getErrMsg(r)):void 0!=r.body.head.err&&0!=r.body.head.err?void App.TipsUtils.showCenter("["+r.body.head.err+"]"+ErrorConst.getDetail(r.body.head.err)):(r&&App.MessageCenter.dispatch(r.cmd,r.body),void e.clear())},i.getErrMsg=function(e){return void 0==e.body?"pb解析错误":void 0==e.body.head?"pb缺少头部信息":(null==e.body.head,"pb解码失败")},i.decode=function(e){var t=e,n=t.readInt();t.readInt(),t.readByte();if(t.bytesAvailable>=n){var i=new egret.ByteArray;t.readBytes(i,0,n);var r={};return r}return null},i.encode=function(e){var t=e.cmd,n=null,i=this.getMessage(this.getReqMsg(e.cmd));n=e.body instanceof protobuf.Message?e.body:i.create(e.body);var r=i.encode(n).finish();return Log.trace("发送数据：","[cmd:"+t+"][Message:"+i+"] [len:"+r.length+"]"),r},t}(ByteArrayMsg);egret.registerClass(ByteArrayMsgByProtobuf,"ByteArrayMsgByProtobuf");var Socket=function(e){function t(){e.call(this),this._needReconnect=!1,this._maxReconnectCount=10,this._reconnectCount=0}__extends(t,e);var n=(__define,t),i=n.prototype;return i.addEvents=function(){this._socket.addEventListener(egret.ProgressEvent.SOCKET_DATA,this.onReceiveMessage,this),this._socket.addEventListener(egret.Event.CONNECT,this.onSocketOpen,this),this._socket.addEventListener(egret.Event.CLOSE,this.onSocketClose,this),this._socket.addEventListener(egret.IOErrorEvent.IO_ERROR,this.onSocketError,this)},i.removeEvents=function(){this._socket.removeEventListener(egret.ProgressEvent.SOCKET_DATA,this.onReceiveMessage,this),this._socket.removeEventListener(egret.Event.CONNECT,this.onSocketOpen,this),this._socket.removeEventListener(egret.Event.CLOSE,this.onSocketClose,this),this._socket.removeEventListener(egret.IOErrorEvent.IO_ERROR,this.onSocketError,this)},i.onSocketOpen=function(){this._reconnectCount=0,this._connectFlag?App.MessageCenter.dispatch(SocketConst.SOCKET_RECONNECT):App.MessageCenter.dispatch(SocketConst.SOCKET_CONNECT),this._connectFlag=!0,this._isConnecting=!0},i.onSocketClose=function(){App.TipsUtils.showCenter("服务器断开连接"),this._needReconnect?(this.reconnect(),App.MessageCenter.dispatch(SocketConst.SOCKET_START_RECONNECT)):App.MessageCenter.dispatch(SocketConst.SOCKET_CLOSE),this._isConnecting=!1},i.onSocketError=function(){App.TipsUtils.showCenter("服务器连接错误"),this._needReconnect?this.reconnect():App.MessageCenter.dispatch(SocketConst.SOCKET_NOCONNECT),this._isConnecting=!1},i.onReceiveMessage=function(e){this._msg.receive(this._socket)},i.initServer=function(e,t,n){this._host=e,this._port=t,this._msg=n},i.connect=function(){return App.DeviceUtils.IsHtml5&&!window.WebSocket?void Log.trace("不支持WebSocket"):(this._socket=new egret.WebSocket,this._msg instanceof ByteArrayMsg&&(this._socket.type=egret.WebSocket.TYPE_BINARY),Log.trace("WebSocket: "+this._host+":"+this._port),this._socket.connect(this._host,this._port),void this.addEvents())},i.reconnect=function(){this.close(),this._reconnectCount++,this._reconnectCount<this._maxReconnectCount?this.connect():(this._reconnectCount=0,this._connectFlag?App.MessageCenter.dispatch(SocketConst.SOCKET_CLOSE):App.MessageCenter.dispatch(SocketConst.SOCKET_NOCONNECT))},i.send=function(e){this._msg.send(this._socket,e)},i.writeAndFlush=function(e,t,n){this._msg.writeAndFlush(this._socket,e,t,n)},i.close=function(){this.removeEvents(),this._socket.close(),this._socket=null,this._isConnecting=!1,this._connectFlag=!1},i.isConnecting=function(){return this._isConnecting},i.debugInfo=function(e){App.MessageCenter.dispatch(SocketConst.SOCKET_DEBUG_INFO,e)},t}(BaseClass);egret.registerClass(Socket,"Socket");var SocketConst=function(){function e(){}var t=(__define,e);t.prototype;return e.SOCKET_CONNECT="SOCKET_CONNECT",e.SOCKET_RECONNECT="SOCKET_RECONNECT",e.SOCKET_START_RECONNECT="SOCKET_START_RECONNECT",e.SOCKET_CLOSE="SOCKET_CLOSE",e.SOCKET_DATA="SOCKET_DATA",e.SOCKET_NOCONNECT="SOCKET_NOCONNECT",e.SOCKET_DEBUG_INFO="SOCKET_DEBUG_INFO",e}();egret.registerClass(SocketConst,"SocketConst");var UTFMsg=function(){function e(){}var t=(__define,e),n=t.prototype;return n.receive=function(e){var t=e.readUTF(),n=this.decode(t);n&&App.MessageCenter.dispatch(n.key,n.body)},n.send=function(e,t){var n=this.encode(t);n&&(e.type=egret.WebSocket.TYPE_STRING,e.writeUTF(n))},n.writeAndFlush=function(e,t,n){},n.decode=function(e){return Log.trace("decode需要子类重写，根据项目的协议结构解析"),null},n.encode=function(e){return Log.trace("encode需要子类重写，根据项目的协议结构解析"),null},e}();egret.registerClass(UTFMsg,"UTFMsg",["BaseMsg"]);var UTFMsgByJson=function(e){function t(){e.call(this)}__extends(t,e);var n=(__define,t),i=n.prototype;return i.decode=function(e){return JSON.parse(e)},i.encode=function(e){return JSON.stringify(e)},t}(UTFMsg);egret.registerClass(UTFMsgByJson,"UTFMsgByJson");var ErrorInfo=function(){function e(e,t){this.code=0,this.detail="",this.code=e,this.detail=t}var t=(__define,e);t.prototype;return e}();egret.registerClass(ErrorInfo,"ErrorInfo");var ErrorConst=function(){function e(){}var t=(__define,e);t.prototype;return e.getDetail=function(t){for(var n in e.list)if(e.list[n].code==t)return e.list[n].detail;return"未知错误"},e.list=[new ErrorInfo(1001,"重复登录"),new ErrorInfo(1002,"找不到这个玩家"),new ErrorInfo(1003,"还没有登录(不能做相关操作)"),new ErrorInfo(1004,"创建房间失败"),new ErrorInfo(2e3,"找不到对应的 online session"),new ErrorInfo(2001,"玩家已经在房间服务器了"),new ErrorInfo(2002,"房间满座"),new ErrorInfo(2003,"房间观察者满座"),new ErrorInfo(2004,"房间已存在, 不能再创建相同ID的房间"),new ErrorInfo(2005,"房间不存在, 不能加入"),new ErrorInfo(2006,"房间服务器里根据online_id没有找到online(获取session失败)"),new ErrorInfo(2007,"重复注册 online"),new ErrorInfo(2008,"玩家不在任何房间"),new ErrorInfo(2009,"玩家不在当前打牌/离开的房间"),new ErrorInfo(2010,"找不到房间"),new ErrorInfo(2011,"玩家记录的座位号在 p.room 里面对应座位上的人不是 p"),new ErrorInfo(2012,"玩家记录的ob号在 p.room 里面对应ob位上的人不是 p"),new ErrorInfo(2013,"玩家记录了 p.room, 但没有记录 p.seat 也没有记录 p.ob"),new ErrorInfo(2014,"ob 不能发起解散房间的请求"),new ErrorInfo(2015,"玩家已经绑定了房间, 不能再创建/加入别的房间了"),new ErrorInfo(2016,"房间已经关闭"),new ErrorInfo(2017,"无法申请 roomid (因为room_idgen获取不到"),new ErrorInfo(2018,"无效的 roomid"),new ErrorInfo(2019,"不能进入房间(被房间服拒绝)"),new ErrorInfo(2020,"找不到 UID 绑定的房间"),new ErrorInfo(2021,"不是创建者不能直接解散房间"),new ErrorInfo(2022,"不能直接解散开始的房间, 必须投票(ask dismiss)"),new ErrorInfo(2023,"不能离开已经开始的房间"),new ErrorInfo(2024,"无效的 debug 登陆请求(空请求或空openid)"),new ErrorInfo(2025,"不支持的登陆方式"),new ErrorInfo(2026,"获取UserInfo失败(NotFound错误除外)"),new ErrorInfo(2027,"获取新Uid失败"),new ErrorInfo(2028,"存储新 UserInfo 失败"),new ErrorInfo(2029,"获取玩家信息失败(NotFound错误除外)"),new ErrorInfo(2030,"存储玩家信息失败"),new ErrorInfo(2031,"进入房间返回0个玩家(至少应该包括房主)"),new ErrorInfo(2032,"房间ID用光了"),new ErrorInfo(2033,"绑定 roomid 和 roomsrvid"),new ErrorInfo(2034,"找不到可用的房间服务器(严重错误)"),new ErrorInfo(2035,"没有开始的房间不能申请解散(只有房主能解散)"),new ErrorInfo(2036,"已经有人申请了解散房间, 此时不能重复申请解散"),new ErrorInfo(2037,"不能应答没有开始的解散房间(BUG?)"),new ErrorInfo(2038,"不能应答没有发起解散决议的房间(BUG?)"),new ErrorInfo(2039,"房间记录了玩家, 但玩家记录的座位是空(RoomServer BUG)"),new ErrorInfo(2040,"对 room 请求多次都不成功(目前尝试100次, 每次间隔10ms) "),new ErrorInfo(2041,"房间服正忙, 请稍后再试"),new ErrorInfo(2042,"房间服内部逻辑错误, 重复关闭房间"),new ErrorInfo(2043,"房间(服)未知错误")],e}();egret.registerClass(ErrorConst,"ErrorConst");var SceneManager=function(e){function t(){e.call(this),this._scenes={}}__extends(t,e);var n=(__define,t),i=n.prototype;return i.clear=function(){var e=this._scenes[this._currScene];e&&(e.onExit(),this._currScene=void 0),this._scenes={}},i.register=function(e,t){this._scenes[e]=t},i.runScene=function(e){var t=this._scenes[e];if(null==t)return void Log.trace("场景"+e+"不存在");var n=this._scenes[this._currScene];n&&n.onExit(),t.onEnter(),this._currScene=e},i.getCurrScene=function(){return this._currScene},t}(BaseClass);egret.registerClass(SceneManager,"SceneManager");var BaseSound=function(){function e(){this._cache={},this._loadingCache=new Array,App.TimerManager.doTimer(6e4,0,this.dealSoundTimer,this)}var t=(__define,e),n=t.prototype;return n.dealSoundTimer=function(){for(var e=egret.getTimer(),t=Object.keys(this._cache),n=0,i=t.length;i>n;n++){var r=t[n];this.checkCanClear(r)&&e-this._cache[r]>=SoundManager.CLEAR_TIME&&(delete this._cache[r],RES.destroyRes(r))}},n.getSound=function(e){var t=RES.getRes(e);if(t)this._cache[e]&&(this._cache[e]=egret.getTimer());else{if(-1!=this._loadingCache.indexOf(e))return null;this._loadingCache.push(e),RES.getResAsync(e,this.onResourceLoadComplete,this)}return t},n.onResourceLoadComplete=function(e,t){var n=this._loadingCache.indexOf(t);-1!=n&&(this._loadingCache.splice(n,1),this._cache[t]=egret.getTimer(),this.loadedPlay(t))},n.loadedPlay=function(e){},n.checkCanClear=function(e){return!0},e}();egret.registerClass(BaseSound,"BaseSound");var SoundBg=function(e){function t(){e.call(this),this._currBg=""}__extends(t,e);var n=(__define,t),i=n.prototype;return i.stop=function(){this._currSoundChannel&&this._currSoundChannel.stop(),this._currSoundChannel=null,this._currSound=null,this._currBg=""},i.play=function(e){if(this._currBg!=e){this.stop(),this._currBg=e;var t=this.getSound(e);t&&this.playSound(t)}},i.playSound=function(e){this._currSound=e,this._currSoundChannel=this._currSound.play(0,1),this._currSoundChannel.volume=this._volume},i.setVolume=function(e){this._volume=e,this._currSoundChannel&&(this._currSoundChannel.volume=this._volume)},i.loadedPlay=function(e){this._currBg==e&&this.playSound(RES.getRes(e))},i.checkCanClear=function(e){return this._currBg!=e},t}(BaseSound);egret.registerClass(SoundBg,"SoundBg");var SoundEffects=function(e){function t(){e.call(this)}__extends(t,e);var n=(__define,t),i=n.prototype;return i.play=function(e){var t=this.getSound(e);t&&this.playSound(t)},i.playSound=function(e){var t=e.play(0,1);t.volume=this._volume},i.setVolume=function(e){this._volume=e},i.loadedPlay=function(e){this.playSound(RES.getRes(e))},t}(BaseSound);egret.registerClass(SoundEffects,"SoundEffects");var SoundManager=function(e){function t(){e.call(this),this.bgOn=!0,this.effectOn=!0,this.bgVolume=.5,this.effectVolume=.5,this.bg=new SoundBg,this.bg.setVolume(this.bgVolume),this.effect=new SoundEffects,this.effect.setVolume(this.effectVolume)}__extends(t,e);var n=(__define,t),i=n.prototype;return i.playEffect=function(e){this.effectOn&&this.effect.play(e)},i.playBg=function(e){this.currBg=e,this.bgOn&&this.bg.play(e)},i.stopBg=function(){this.bg.stop()},i.setEffectOn=function(e){this.effectOn=e},i.setBgOn=function(e){this.bgOn=e,this.bgOn?this.currBg&&this.playBg(this.currBg):this.stopBg()},i.setBgVolume=function(e){e=Math.min(e,1),e=Math.max(e,0),this.bgVolume=e,this.bg.setVolume(this.bgVolume)},i.getBgVolume=function(){return this.bgVolume},i.setEffectVolume=function(e){e=Math.min(e,1),e=Math.max(e,0),this.effectVolume=e,this.effect.setVolume(this.effectVolume)},i.getEffectVolume=function(){return this.effectVolume},t.CLEAR_TIME=18e4,t}(BaseClass);egret.registerClass(SoundManager,"SoundManager");var AverageUtils=function(){function e(e){void 0===e&&(e=10),this.nums=[],this.numsLen=0,this.numSum=0,this.maxNum=e}var t=(__define,e),n=t.prototype;return n.push=function(e){this.numsLen>this.maxNum&&(this.numsLen--,this.numSum-=this.nums.shift()),this.nums.push(e),this.numSum+=e,this.numsLen++},n.getValue=function(){return this.numSum/this.numsLen},n.clear=function(){this.nums.splice(0),this.numsLen=0,this.numSum=0},e}();egret.registerClass(AverageUtils,"AverageUtils");var DebugUtils=function(e){function t(){e.call(this),this._threshold=3,this._startTimes={}}__extends(t,e);var n=__define,i=t,r=i.prototype;return r.isOpen=function(e){this._isOpen=e},n(r,"isDebug",function(){return this._isOpen}),r.start=function(e){this._isOpen&&(this._startTimes[e]=egret.getTimer())},r.stop=function(e){if(!this._isOpen)return 0;if(!this._startTimes[e])return 0;var t=egret.getTimer()-this._startTimes[e];return t>this._threshold&&Log.trace(e+": "+t),t},r.setThreshold=function(e){this._threshold=e},t}(BaseClass);egret.registerClass(DebugUtils,"DebugUtils");var DeviceUtils=function(e){function t(){e.call(this)}__extends(t,e);var n=__define,i=t,r=i.prototype;return n(r,"IsHtml5",function(){return egret.Capabilities.runtimeType==egret.RuntimeType.WEB}),n(r,"IsNative",function(){return egret.Capabilities.runtimeType==egret.RuntimeType.NATIVE}),n(r,"IsMobile",function(){return egret.Capabilities.isMobile}),n(r,"IsPC",function(){return!egret.Capabilities.isMobile}),n(r,"IsQQBrowser",function(){return this.IsHtml5&&-1!=navigator.userAgent.indexOf("MQQBrowser")}),n(r,"IsIEBrowser",function(){return this.IsHtml5&&-1!=navigator.userAgent.indexOf("MSIE")}),n(r,"IsFirefoxBrowser",function(){return this.IsHtml5&&-1!=navigator.userAgent.indexOf("Firefox")}),n(r,"IsChromeBrowser",function(){return this.IsHtml5&&-1!=navigator.userAgent.indexOf("Chrome")}),n(r,"IsSafariBrowser",function(){return this.IsHtml5&&-1!=navigator.userAgent.indexOf("Safari")}),n(r,"IsOperaBrowser",function(){return this.IsHtml5&&-1!=navigator.userAgent.indexOf("Opera")}),t}(BaseClass);egret.registerClass(DeviceUtils,"DeviceUtils");var DisplayUtils=function(e){function t(){e.call(this)}__extends(t,e);var n=(__define,t),i=n.prototype;return i.createBitmap=function(e){var t=new egret.Bitmap,n=RES.getRes(e);return t.texture=n,t},i.createEuiImage=function(e){var t=new eui.Image,n=RES.getRes(e);return t.source=n,t},i.removeFromParent=function(e){void 0!=e&&null!=e.parent&&e.parent.removeChild(e)},t}(BaseClass);egret.registerClass(DisplayUtils,"DisplayUtils");var Log=function(){function e(){}var t=(__define,e);t.prototype;return e.trace=function(){for(var e=[],t=0;t<arguments.length;t++)e[t-0]=arguments[t];App.DebugUtils.isDebug&&(e[0]="[Log]"+e[0],console.log.apply(console,e))},e.error=function(){for(var e=[],t=0;t<arguments.length;t++)e[t-0]=arguments[t];App.DebugUtils.isDebug&&(e[0]="[Error]"+e[0],console.log.apply(console,e))},e}();egret.registerClass(Log,"Log");var MessageCenter=function(e){function t(t){e.call(this),this.type=t,this.dict={},this.eVec=new Array,this.lastRunTime=0,0==this.type&&App.TimerManager.doFrame(1,0,this.run,this)}__extends(t,e);var n=(__define,t),i=n.prototype;return i.clear=function(){this.dict={},this.eVec.splice(0)},i.addListener=function(e,t,n){var i=this.dict[e];null==i&&(i=new Array,this.dict[e]=i);var r=0,s=i.length;for(r;s>r;r++)if(i[r][0]==t&&i[r][1]==n)return;i.push([t,n])},i.removeListener=function(e,t,n){var i=this.dict[e];if(null!=i){var r=0,s=i.length;for(r;s>r;r++)if(i[r][0]==t&&i[r][1]==n){i.splice(r,1);break}0==i.length&&(this.dict[e]=null,delete this.dict[e])}},i.removeAll=function(e){for(var t=Object.keys(this.dict),n=0,i=t.length;i>n;n++){for(var r=t[n],s=this.dict[r],o=0;o<s.length;o++)s[o][1]==e&&(s.splice(o,1),o--);0==s.length&&(this.dict[r]=null,delete this.dict[r])}},i.dispatch=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];if(null!=this.dict[e]){var i=ObjectPool.pop("MessageVo");i.type=e,i.param=t,0==this.type?this.eVec.push(i):1==this.type?this.dealMsg(i):Log.trace("MessageCenter未实现的类型")}},i.run=function(){var e=egret.getTimer(),t=e-this.lastRunTime>100;if(this.lastRunTime=e,t)for(;this.eVec.length>0;)this.dealMsg(this.eVec.shift());else for(;this.eVec.length>0&&(this.dealMsg(this.eVec.shift()),!(egret.getTimer()-e>5)););},i.dealMsg=function(e){for(var t=this.dict[e.type],n=0,i=t.length,r=null;i>n;)r=t[n],r[0].apply(r[1],e.param),t.length!=i&&(i=t.length,n--),n++;e.dispose(),ObjectPool.push(e)},t}(BaseClass);egret.registerClass(MessageCenter,"MessageCenter");var MessageVo=function(){function e(){}var t=(__define,e),n=t.prototype;return n.dispose=function(){this.type=null,this.param=null},e}();egret.registerClass(MessageVo,"MessageVo");var ObjectPool=function(){function e(){this._objs=new Array}var t=(__define,e),n=t.prototype;return n.pushObj=function(e){this._objs.push(e)},n.popObj=function(){return this._objs.length>0?this._objs.pop():null},n.clear=function(){for(;this._objs.length>0;)this._objs.pop()},e.pop=function(t){for(var n=[],i=1;i<arguments.length;i++)n[i-1]=arguments[i];e._content[t]||(e._content[t]=[]);var r=e._content[t];if(r.length)return r.pop();var s,o=egret.getDefinitionByName(t),a=n.length;return 0==a?s=new o:1==a?s=new o(n[0]):2==a?s=new o(n[0],n[1]):3==a?s=new o(n[0],n[1],n[2]):4==a?s=new o(n[0],n[1],n[2],n[3]):5==a&&(s=new o(n[0],n[1],n[2],n[3],n[4])),s.ObjectPoolKey=t,s},e.popWithExtraKey=function(t,n){e._content[t]||(e._content[t]=[]);var i,r=e._content[t];if(r.length)for(var s=0;s<r.length;s++)if(r[s].extraKey==n){i=r[s],r.splice(s,1);break}if(!i){var o=egret.getDefinitionByName(t);i=new o(n),i.extraKey=n,i.ObjectPoolKey=t}return i},e.push=function(t){if(null==t)return!1;var n=t.ObjectPoolKey;return e._content[n]?(e._content[n].push(t),!0):!1},e.clear=function(){e._content={}},e.clearClass=function(t,n){void 0===n&&(n=null);for(var i=e._content[t];i&&i.length;){var r=i.pop();n&&r[n](),r=null}e._content[t]=null,delete e._content[t]},e.dealFunc=function(t,n){var i=e._content[t];if(null!=i){var r=0,s=i.length;for(r;s>r;r++)i[r][n]()}},e._content={},e}();egret.registerClass(ObjectPool,"ObjectPool");var ResVersionManager=function(e){function t(){e.call(this),this.res_loadByVersion()}__extends(t,e);var n=(__define,t),i=n.prototype;return i.res_loadByVersion=function(){RES.web.Html5VersionController.prototype.getVirtualUrl=function(e){var n="",i=t.resVersionData,r=e.substring(9);return i&&i[r]&&(n=i[r]),0==n.length&&(n=Math.random()+""),e+=-1==e.indexOf("?")?"?v="+n:"&v="+n}},i.loadConfig=function(e,t,n){this.complateFunc=t,this.complateFuncTarget=n,RES.getResByUrl(e,this.loadResVersionComplate,this)},i.loadResVersionComplate=function(e){t.resVersionData=e,this.complateFunc.call(this.complateFuncTarget)},t}(BaseClass);egret.registerClass(ResVersionManager,"ResVersionManager");var ResourceUtils=function(e){function t(){e.call(this),this._groupIndex=0,this._configs=new Array,this._groups={},RES.addEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResourceLoadComplete,this),RES.addEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onResourceLoadProgress,this),RES.addEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onResourceLoadError,this)}__extends(t,e);var n=(__define,t),i=n.prototype;return i.addConfig=function(e,t){this._configs.push([e,t])},i.loadConfig=function(e,t){this._onConfigComplete=e,this._onConfigCompleteTarget=t,this.loadNextConfig()},i.loadNextConfig=function(){if(0==this._configs.length)return this._onConfigComplete.call(this._onConfigCompleteTarget),this._onConfigComplete=null,void(this._onConfigCompleteTarget=null);var e=this._configs.shift();RES.addEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigCompleteHandle,this),RES.loadConfig(e[0],e[1])},i.onConfigCompleteHandle=function(e){RES.removeEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigCompleteHandle,this),this.loadNextConfig()},i.loadGroup=function(e,t,n,i){this._groups[e]=[t,n,i],RES.loadGroup(e)},i.loadGroups=function(e,t,n,i,r){RES.createGroup(e,t,!0),this.loadGroup(e,n,i,r)},i.pilfererLoadGroup=function(e,t){void 0===t&&(t=null);var n="pilferer_"+e;t||(t=[e]),RES.createGroup(n,t,!0),RES.loadGroup(n,-1)},i.onResourceLoadComplete=function(e){var t=e.groupName;if(this._groups[t]){var n=this._groups[t][0],i=this._groups[t][2];null!=n&&n.call(i),this._groups[t]=null,delete this._groups[t]}},i.onResourceLoadProgress=function(e){var t=e.groupName;if(this._groups[t]){var n=this._groups[t][1],i=this._groups[t][2];null!=n&&n.call(i,e.itemsLoaded,e.itemsTotal)}},i.onResourceLoadError=function(e){Log.trace(e.groupName+"资源组有资源加载失败"),this.onResourceLoadComplete(e)},i.loadResource=function(e,t,n,i,r){void 0===e&&(e=[]),void 0===t&&(t=[]),void 0===n&&(n=null),void 0===i&&(i=null),void 0===r&&(r=null);var s=e.concat(t),o="loadGroup"+this._groupIndex++;RES.createGroup(o,s,!0),this._groups[o]=[n,i,r],RES.loadGroup(o)},t}(BaseClass);egret.registerClass(ResourceUtils,"ResourceUtils");var StageUtils=function(e){function t(){e.call(this),null==t._uiStage&&(t._uiStage=new eui.UILayer,t._uiStage.percentHeight=100,t._uiStage.percentWidth=100,t._uiStage.touchEnabled=!1,this.getStage().addChild(t._uiStage))}__extends(t,e);var n=(__define,t),i=n.prototype;return i.getHeight=function(){return this.getStage().stageHeight},i.getWidth=function(){return this.getStage().stageWidth},i.setTouchChildren=function(e){this.getStage().touchChildren=e},i.setMaxTouches=function(e){this.getStage().maxTouches=e},i.setFrameRate=function(e){this.getStage().frameRate=e},i.setScaleMode=function(e){this.getStage().scaleMode=e},i.getStage=function(){return egret.MainContext.instance.stage},i.getUIStage=function(){return t._uiStage},t}(BaseClass);egret.registerClass(StageUtils,"StageUtils");var TimerManager=function(e){function t(){e.call(this),this._handlers=new Array,this._delHandlers=new Array,this._currTime=egret.getTimer(),this._currFrame=0,this._count=0,this._timeScale=1,egret.Ticker.getInstance().register(this.onEnterFrame,this)}__extends(t,e);var n=__define,i=t,r=i.prototype;return r.setTimeScale=function(e){this._timeScale=e},r.onEnterFrame=function(){this._currFrame++,this._currTime=egret.getTimer(),App.DebugUtils.start("TimerManager:");for(var e=0;e<this._count;e++){var t=this._handlers[e],n=t.userFrame?this._currFrame:this._currTime;n>=t.exeTime&&(App.DebugUtils.start(t.method.toString()),t.method.call(t.methodObj,(this._currTime-t.dealTime)*this._timeScale),App.DebugUtils.stop(t.method.toString()),t.dealTime=this._currTime,t.exeTime+=t.delay,t.repeat||(t.repeatCount>1?t.repeatCount--:(t.complateMethod&&t.complateMethod.apply(t.complateMethodObj),this._delHandlers.push(t))))}for(;this._delHandlers.length;){var t=this._delHandlers.pop();this.remove(t.method,t.methodObj)}App.DebugUtils.stop("TimerManager:")},r.create=function(e,t,n,i,r,s,o){if(!(0>t||0>n||null==i)){this.remove(i,r);var a=ObjectPool.pop("TimerHandler");a.userFrame=e,a.repeat=0==n,a.repeatCount=n,a.delay=t,a.method=i,a.methodObj=r,a.complateMethod=s,a.complateMethodObj=o,a.exeTime=t+(e?this._currFrame:this._currTime),a.dealTime=this._currTime,this._handlers.push(a),this._count++}},r.doTimer=function(e,t,n,i,r,s){void 0===r&&(r=null),void 0===s&&(s=null),this.create(!1,e,t,n,i,r,s)},r.doFrame=function(e,t,n,i,r,s){void 0===r&&(r=null),void 0===s&&(s=null),this.create(!0,e,t,n,i,r,s)},n(r,"count",function(){return this._count}),r.remove=function(e,t){for(var n=0;n<this._count;n++){var i=this._handlers[n];if(i.method==e&&i.methodObj==t){this._handlers.splice(n,1),ObjectPool.push(i),this._count--;break}}},r.removeAll=function(e){for(var t=0;t<this._count;t++){var n=this._handlers[t];n.methodObj==e&&(this._handlers.splice(t,1),ObjectPool.push(n),this._count--,t--)}},r.isExists=function(e,t){for(var n=0;n<this._count;n++){var i=this._handlers[n];if(i.method==e&&i.methodObj==t)return!0}return!1},t}(BaseClass);egret.registerClass(TimerManager,"TimerManager");var TimerHandler=function(){function e(){this.delay=0,this.repeatCount=0,this.exeTime=0,this.dealTime=0}var t=(__define,e),n=t.prototype;return n.clear=function(){this.method=null,this.methodObj=null,this.complateMethod=null,this.complateMethodObj=null},e}();egret.registerClass(TimerHandler,"TimerHandler");var TipsUtils=function(e){function t(){e.call(this),this._ctips=new Array}__extends(t,e);var n=(__define,t),i=n.prototype;return i.showCenter=function(e){for(var t=null,n=0;n<this._ctips.length;n++)if(0==this._ctips[n].getStatus()){t=this._ctips[n];break}null==t&&(t=new CenterTips,this._ctips.push(t)),t.show(e,LayerManager.UI_Tips,!0,4)},t}(BaseClass);egret.registerClass(TipsUtils,"TipsUtils");