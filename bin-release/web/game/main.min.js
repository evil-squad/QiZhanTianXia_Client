var LoadingUI=function(e){function t(){e.call(this),this.createView()}__extends(t,e);var n=(__define,t),r=n.prototype;return r.createView=function(){this.textField=new egret.TextField,this.addChild(this.textField),this.textField.y=300,this.textField.width=480,this.textField.height=100,this.textField.textAlign="center"},r.setProgress=function(e,t){this.textField.text="Loading..."+e+"/"+t},t}(egret.Sprite);egret.registerClass(LoadingUI,"LoadingUI");var Main=function(e){function t(){e.call(this),this.addEventListener(egret.Event.ADDED_TO_STAGE,this.onAddToStage,this)}__extends(t,e);var n=(__define,t),r=n.prototype;return r.onAddToStage=function(e){this.removeEventListener(egret.Event.ADDED_TO_STAGE,this.onAddToStage,this),this.stage.registerImplementation("eui.IAssetAdapter",new AssetAdapter),this.stage.registerImplementation("eui.IThemeAdapter",new ThemeAdapter),App.DeviceUtils.IsPC&&App.StageUtils.setScaleMode(egret.StageScaleMode.SHOW_ALL),this.initScene(),this.initModule(),App.SceneManager.runScene(SceneConsts.LOADING),this.loadResVersionComplate()},r.loadResVersionComplate=function(){App.ResourceUtils.addConfig("resource/default.res.json","resource/"),App.ResourceUtils.addConfig("resource/resource_core.json","resource/"),App.ResourceUtils.addConfig("resource/resource_ui.json","resource/"),App.ResourceUtils.addConfig("resource/resource_battle.json","resource/"),App.ResourceUtils.addConfig("resource/resource_mj.json","resource/"),App.ResourceUtils.loadConfig(this.onConfigComplete,this)},r.onConfigComplete=function(){var e=new eui.Theme("resource/default.thm.json",this.stage);e.addEventListener(eui.UIEvent.COMPLETE,this.onThemeLoadComplete,this)},r.onThemeLoadComplete=function(){new Startup},r.initScene=function(){App.SceneManager.register(SceneConsts.LOADING,new LoadingScene),App.SceneManager.register(SceneConsts.Enter,new EnterScene),App.SceneManager.register(SceneConsts.Home,new HomeScene),App.SceneManager.register(SceneConsts.Room,new RoomScene)},r.initModule=function(){App.ControllerManager.register(ControllerConst.Loading,new LoadingController)},t}(egret.DisplayObjectContainer);egret.registerClass(Main,"Main");var Startup=function(){function e(){var e="preload",t=["preload_core","preload_ui","preload_mj"];App.ResourceUtils.loadGroups(e,t,this.onResourceLoadComplete,this.onResourceLoadProgress,this)}var t=(__define,e),n=t.prototype;return n.onResourceLoadComplete=function(){this.initModule(),App.Init(),App.SoundManager.setBgOn(!0),App.SoundManager.setEffectOn(!App.DeviceUtils.IsHtml5||!App.DeviceUtils.IsMobile),App.SceneManager.runScene(SceneConsts.Enter)},n.onResourceLoadProgress=function(e,t){App.ControllerManager.applyFunc(ControllerConst.Loading,LoadingConst.SetProgress,e,t)},n.initModule=function(){App.ControllerManager.register(ControllerConst.Servers,new ServerChooseController),App.ControllerManager.register(ControllerConst.Login,new LoginController),App.ControllerManager.register(ControllerConst.Home,new HomeController),App.ControllerManager.register(ControllerConst.Room,new RoomController)},e}();egret.registerClass(Startup,"Startup");var Menu=function(e){function t(){e.call(this)}__extends(t,e);var n=(__define,t);n.prototype;return t}(eui.Component);egret.registerClass(Menu,"Menu");var Cmd=function(){function e(){}var t=(__define,e);t.prototype;return e.LOGIN=1,e.ROOM_CREATE=101,e.ROOM_DISMISS=102,e.ROOM_ENTER=103,e.ROOM_LEAVE=104,e.ROOM_PLAYER_INFO_GET=105,e.ROOM_NOTIRY=106,e}();egret.registerClass(Cmd,"Cmd");var ControllerConst;!function(e){e[e.Loading=1e4]="Loading",e[e.Login=10001]="Login",e[e.Home=10002]="Home",e[e.Servers=10003]="Servers",e[e.Room=10004]="Room"}(ControllerConst||(ControllerConst={}));var HttpConst=function(){function e(){}var t=(__define,e);t.prototype;return e.USER_LOGIN="User.login",e}();egret.registerClass(HttpConst,"HttpConst");var Msg=function(){function e(){}var t=(__define,e);t.prototype;return e.ERR="errpb.ERR",e.Head="cspb.Head",e.User="storepb.User",e.Player="storepb.Player",e.RegInfo="storepb.User.RegInfo",e.DEBUG="cspb.LoginReq.Debug",e.WECHAT="cspb.LoginReq.Wechat",e.LoginReq="cspb.LoginReq",e.LoginResp="cspb.LoginResp",e.CreateRoomReq="cspb.CreateRoomReq",e.CreateRoomResp="cspb.CreateRoomResp",e.DismissRoomReq="cspb.DismissRoomReq",e.DismissRoomResp="cspb.DismissRoomResp",e.EnterRoomReq="cspb.EnterRoomReq",e.EnterRoomResp="cspb.EnterRoomResp",e.LeaveRoomReq="cspb.LeaveRoomReq",e.LeaveRoomResp="cspb.LeaveRoomResp",e.GetRoomPlayerInfoReq="cspb.GetRoomPlayerInfoReq",e.GetRoomPlayerInfoResp="cspb.GetRoomPlayerInfoResp",e.RoomNotify="cspb.RoomNotify",e.TextMsg="talkpb.TextMsg",e}();egret.registerClass(Msg,"Msg");var ProtoConst=function(){function e(){}var t=(__define,e);t.prototype;return e.CS="cspb",e.ERR="errpb",e.ROOM="roompb",e.STORE="storepb",e.TALK="talkpb",e}();egret.registerClass(ProtoConst,"ProtoConst");var SceneConsts;!function(e){e[e.Enter=1]="Enter",e[e.Room=2]="Room",e[e.Home=3]="Home",e[e.LOADING=4]="LOADING"}(SceneConsts||(SceneConsts={}));var ViewConst;!function(e){e[e.Loading=1e4]="Loading",e[e.ServerChoose=10001]="ServerChoose",e[e.Login=10002]="Login",e[e.Home=10003]="Home",e[e.Room=2e4]="Room",e[e.RoomUI=20001]="RoomUI"}(ViewConst||(ViewConst={}));var MahjongManager=function(){function e(){}var t=(__define,e);t.prototype;return e.random=function(t){for(var n,r=new Array,i=1;r.length<t;){for(var s=Math.floor(58*Math.random())+10;-1==e.mids.indexOf(s);)s=Math.floor(58*Math.random())+10;n=new MahjongInfo,n.id=i,n.mid=s,r.push(n),i++}return r},e.mids=[11,12,13,14,15,16,17,18,19,21,22,23,24,25,26,27,28,29,,31,32,33,34,35,36,37,38,39,,41,42,43,44,45,46,47,,51,52,53,54,55,56,57,58],e}();egret.registerClass(MahjongManager,"MahjongManager");var MainManager=function(){function e(){}var t=__define,n=e;n.prototype;return e.setUserInfo=function(e){this._userInfo=new UserInfo(e)},t(e,"userId",function(){return this._userId}),t(e,"userInfo",function(){return this._userInfo}),e}();egret.registerClass(MainManager,"MainManager");var RoomManager=function(){function e(){}var t=__define,n=e;n.prototype;return t(e,"playerIds",function(){for(var t=new Array,n=0;n<e.playerCount;n++)t.push(this._players[n].uid);return t}),e.addPlayer=function(t){return this._players.length>e.MAX_PLAYER_CNT?-1:this._players.push(t)},e.setRoomInfo=function(e,t){this._roomId=e,this._seatId=t},e.clearPlayers=function(){this._players=[]},t(e,"playerCount",function(){return this._players.length}),t(e,"players",function(){return this._players}),t(e,"isOb",function(){return this._isOb},function(e){this._isOb=e}),t(e,"roomId",function(){return this._roomId},function(e){this._roomId=e}),t(e,"seatId",function(){return this._seatId},function(e){this._seatId=e}),t(e,"hasRoomInfo",function(){return null!=this._roomId}),e.clearRoomInfo=function(){this._roomId=null,this._seatId=0},e.MAX_PLAYER_CNT=4,e._players=new Array,e._isOb=!1,e}();egret.registerClass(RoomManager,"RoomManager");var BMahjongBar=function(e){function t(){e.call(this),this._infos=new Array,this._items=new Array}__extends(t,e);var n=__define,r=t,i=r.prototype;return n(i,"data",void 0,function(e){this._infos=e,this.render()}),i.switchItem=function(e){null==this._curtItem?(this._curtItem=e,this._curtItem.switchMove()):(this._curtItem!=e&&this._curtItem.revertPos(),this._curtItem=e,this._curtItem.switchMove())},i.render=function(){this.removeAllChildren();var e,n=this._infos.length;this._infos.sort(this.sortFun);for(var r=0;n>r;r++)r>this._items.length-1&&(e=new MahjongItem,this._items.push(e)),e=this._items[r],e.info=this._infos[r],this.addChild(e),egret.Tween.get(e).to({x:t.ITEM_WIDTH*r},1e3)},i.sortFun=function(e,t){return e.mid==t.mid?0:e.mid>t.mid?1:-1},i.removeAllChildren=function(){for(;this.numChildren>0;)this.removeChildAt(0)},t.ITEM_WIDTH=40,t.ITEM_HEIGHT=60,t}(eui.Component);egret.registerClass(BMahjongBar,"BMahjongBar");var BaseMahjongItem=function(e){function t(){e.call(this)}__extends(t,e);var n=(__define,t);n.prototype;return t}(eui.Component);egret.registerClass(BaseMahjongItem,"BaseMahjongItem");var MahjongItem=function(e){function t(){e.call(this),this._status=0,this._status=0,this._img=new egret.Bitmap,this.addChild(this._img),this._img.width=BMahjongBar.ITEM_WIDTH,this._img.height=BMahjongBar.ITEM_HEIGHT}__extends(t,e);var n=__define,r=t,i=r.prototype;return n(i,"info",void 0,function(e){this._info=e,this.refresh()}),i.switchMove=function(){egret.Tween.removeTweens(this),0==this._status?(this._status=1,egret.Tween.get(this).to({y:-20},300)):(this._status=0,egret.Tween.get(this).to({y:0},300))},i.revertPos=function(){egret.Tween.get(this).to({y:0},300)},i.discard=function(){},i.refresh=function(){null!=this._info&&(this._img.texture=RES.getRes("mj"+this._info.mid))},t}(BaseMahjongItem);egret.registerClass(MahjongItem,"MahjongItem");var MahjongInfo=function(){function e(){}var t=__define,n=e,r=n.prototype;return t(r,"id",function(){return this._id},function(e){this._id=e}),t(r,"mid",function(){return this._mid},function(e){this._mid=e}),e}();egret.registerClass(MahjongInfo,"MahjongInfo");var PlayerInfo=function(){function e(e){null!=e&&(this._id=e.id,this._uid=e.uid,this._nick=e.nick,this._roleTime=e.role_time,this._coins=e.coins,this._lastLoginTime=e.last_login_time)}var t=__define,n=e,r=n.prototype;return t(r,"id",function(){return this._id}),t(r,"uid",function(){return this._uid}),t(r,"nick",function(){return this._nick}),t(r,"coins",function(){return this._coins}),e}();egret.registerClass(PlayerInfo,"PlayerInfo");var UserInfo=function(){function e(e){null!=e&&(this._id=e.id,this._uid=e.uid,this._nick=e.nick,this._roleTime=e.role_time,this._coins=e.coins,this._lastLoginTime=e.last_login_time)}var t=__define,n=e,r=n.prototype;return t(r,"id",function(){return this._id}),t(r,"uid",function(){return this._uid}),t(r,"nick",function(){return this._nick}),t(r,"coins",function(){return this._coins}),e}();egret.registerClass(UserInfo,"UserInfo");var HomeConst=function(){function e(){}var t=(__define,e);t.prototype;return e.ROOM_CREATE_REQ="create.room.req",e.ROOM_CREATE_RESP="create.room.resp",e.ROOM_DISMISS_REQ="dismiss.room.req",e.ROOM_DISMISS_RESP="dismiss.room.resp",e.ROOM_ENTER_REQ="enter.room.req",e.ROOM_ENTER_RESP="enter.room.resp",e.ROOM_LEAVE_REQ="leave.room.req",e.ROOM_LEAVE_RESP="leave.room.resp",e.ROOM_PLAYERS_GET_REQ="get.players.room.req",e.ROOM_PLAYERS_GET_RESP="get.players.room.resp",e}();egret.registerClass(HomeConst,"HomeConst");var BaseController=function(){function e(){this._messages={}}var t=(__define,e),n=t.prototype;return n.registerFunc=function(e,t,n){this._messages[e]=[t,n]},n.applyFunc=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];var r=this._messages[e];return r?r[0].apply(r[1],t):(Log.trace("消息"+e+"不存在侦听"),null)},n.applyControllerFunc=function(e,t){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];return App.ControllerManager.applyFunc.apply(App.ControllerManager,arguments)},n.setModel=function(e){this._model=e},n.getModel=function(){return this._model},n.getControllerModel=function(e){return App.ControllerManager.getControllerModel(e)},e}();egret.registerClass(BaseController,"BaseController");var HomeController=function(e){function t(){e.call(this),this.proxy=new HomeProxy(this),this.homeView=new HomeView(this,LayerManager.UI_Main),App.ViewManager.register(ViewConst.Home,this.homeView),this.registerFunc(HomeConst.ROOM_CREATE_REQ,this.onCreate,this),this.registerFunc(HomeConst.ROOM_ENTER_REQ,this.onEnter,this),this.registerFunc(HomeConst.ROOM_CREATE_RESP,this.createResp,this),this.registerFunc(HomeConst.ROOM_ENTER_RESP,this.enterResp,this)}__extends(t,e);var n=(__define,t),r=n.prototype;return r.onCreate=function(){this.proxy.createRoom()},r.onEnter=function(){this.proxy.enterRoom()},r.createResp=function(e,t){this.homeView.createRoomSuccess(),App.TipsUtils.showCenter("创建房间 roomId:"+e+" seatId:"+t)},r.enterResp=function(e){var t=e.players,n="";RoomManager.clearPlayers();for(var r=0;r<t.length;r++)n+=t[r].nick+" ",RoomManager.addPlayer(new PlayerInfo(t[r]));App.TipsUtils.showCenter("进入房间: "+n),App.SceneManager.runScene(SceneConsts.Room)},t}(BaseController);egret.registerClass(HomeController,"HomeController");var BaseProxy=function(){function e(e){this._controller=e}var t=(__define,e),n=t.prototype;return n.applyFunc=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];return this._controller.applyFunc.apply(this._controller,arguments)},n.applyControllerFunc=function(e,t){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];return this._controller.applyControllerFunc.apply(this._controller,arguments)},n.receiveServerMsg=function(e,t,n){App.MessageCenter.addListener(e,t,n)},n.receiveServerMsgOnce=function(e,t,n){var r=function(i){this.removeServerMsg(e,r,this),t.apply(n,i)};this.receiveServerMsg(e,r,this)},n.receiveServerHttpUpdateMsg=function(e,t,n){this.receiveServerMsg(e+"_HttpUpdate",t,n)},n.receiveServerHttpUpdateMsgOnce=function(e,t,n){this.receiveServerMsgOnce(e+"_HttpUpdate",t,n)},n.removeServerMsg=function(e,t,n){App.MessageCenter.removeListener(e,t,n)},n.removeServerHttpUpdateMsg=function(e,t,n){this.removeServerMsg(e+"_HttpUpdate",t,n)},n.sendSocketMsg=function(e){App.Socket.send(e)},n.sendSocketCBMsg=function(e,t){App.Socket.send({cmd:e,body:t})},n.sendSocketCHBMsg=function(e,t,n){n.head=t,App.Socket.send({cmd:e,body:n})},n.sendSocketCEBMsg=function(e,t,n){n.head.err=t,App.Socket.send({cmd:e,body:n})},n.sendHttpMsg=function(e,t){void 0===t&&(t=null),App.Http.send(e,this.getURLVariables(e,t))},n.getURLVariables=function(e,t){var n=e.split("."),r={};r.mod=n[0],r["do"]=n[1],null!=t&&(r.p=t);var i=JSON.stringify(r),s=new egret.URLVariables("data="+i+"&h="+App.ProxyUserFlag);return s},e}();egret.registerClass(BaseProxy,"BaseProxy");var HomeProxy=function(e){function t(t){e.call(this,t),this.receiveServerMsg(Cmd.ROOM_CREATE,this.createRoomSuccess,this),this.receiveServerMsg(Cmd.ROOM_ENTER,this.enterRoomSuccess,this)}__extends(t,e);var n=(__define,t),r=n.prototype;return r.createRoom=function(){var e={head:App.Head};this.sendSocketCBMsg(Cmd.ROOM_CREATE,e)},r.enterRoom=function(){if(!RoomManager.hasRoomInfo)return void App.TipsUtils.showCenter("无房间数据");var e={head:App.Head,ob:RoomManager.isOb,roomid:RoomManager.roomId};this.sendSocketCBMsg(Cmd.ROOM_ENTER,e)},r.createRoomSuccess=function(e){RoomManager.setRoomInfo(e.roomid,e.seatid),this.applyFunc(HomeConst.ROOM_CREATE_RESP,RoomManager.roomId,RoomManager.seatId)},r.enterRoomSuccess=function(e){this.applyFunc(HomeConst.ROOM_ENTER_RESP,e)},t}(BaseProxy);egret.registerClass(HomeProxy,"HomeProxy");var BaseEuiView=function(e){function t(t,n){e.call(this),this._resources=null,this._controller=t,this._myParent=n,this._isInit=!1,this.percentHeight=100,this.percentWidth=100}__extends(t,e);var n=__define,r=t,i=r.prototype;return n(i,"myParent",function(){return this._myParent}),i.setResources=function(e){this._resources=e},i.isInit=function(){return this._isInit},i.applyFunc=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];return this._controller.applyFunc.apply(this._controller,arguments)},i.applyControllerFunc=function(e,t){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];return this._controller.applyControllerFunc.apply(this._controller,arguments)},i.isShow=function(){return null!=this.stage&&this.visible},i.addToParent=function(){this._myParent.addChild(this)},i.removeFromParent=function(){App.DisplayUtils.removeFromParent(this)},i.initUI=function(){this._isInit=!0},i.initData=function(){},i.destroy=function(){this._controller=null,this._myParent=null,this._resources=null},i.open=function(){for(var e=[],t=0;t<arguments.length;t++)e[t-0]=arguments[t]},i.close=function(){for(var e=[],t=0;t<arguments.length;t++)e[t-0]=arguments[t]},i.loadResource=function(e,t){this._resources&&this._resources.length>0?(App.ResourceUtils.loadResource(this._resources,[],e,null,this),this.addEventListener(eui.UIEvent.CREATION_COMPLETE,t,this)):(e(),t())},i.setVisible=function(e){this.visible=e},t}(eui.Component);egret.registerClass(BaseEuiView,"BaseEuiView",["IBaseView"]);var HomeView=function(e){function t(t,n){e.call(this,t,n),this.skinName="resource/skins/GuiScreenSkin.exml"}__extends(t,e);var n=(__define,t),r=n.prototype;return r.initUI=function(){e.prototype.initUI.call(this),this.menu.addEventListener(egret.TouchEvent.TOUCH_TAP,this.menuClickHandler,this),this.menuBtn.addEventListener(egret.Event.CHANGE,this.menuBtnChangeHandler,this),this.friendBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.friendClickHandler,this),this.shopBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.shopClickHandler,this),this.warehouseBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.warehouseClickHandler,this),this.factoryBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.factoryClickHandler,this),this.moreBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.moreClickHandler,this),this.createBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.createClickHandler,this),this.enterBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.enterClickHandler,this)},r.playSound=function(){App.SoundManager.playEffect("sound_dianji")},r.open=function(){for(var t=[],n=0;n<arguments.length;n++)t[n-0]=arguments[n];e.prototype.open.call(this,t),this.refreshView()},r.createClickHandler=function(e){this.applyFunc(HomeConst.ROOM_CREATE_REQ)},r.enterClickHandler=function(e){this.applyFunc(HomeConst.ROOM_ENTER_REQ)},r.friendClickHandler=function(e){},r.shopClickHandler=function(e){this.playSound()},r.warehouseClickHandler=function(e){this.playSound()},r.factoryClickHandler=function(e){this.playSound()},r.moreClickHandler=function(e){this.playSound()},r.menuBtnChangeHandler=function(e){this.playSound(),this.menu&&(this.menu.visible=this.menuBtn.selected)},r.menuClickHandler=function(e){console.log(e.target),e.target==this.menu.taskBtn?(this.playSound(),this.menuBtn.selected=!1,this.menu.visible=!1):e.target==this.menu.dailyBtn?(this.playSound(),this.menuBtn.selected=!1,this.menu.visible=!1):e.target==this.menu.mailBtn&&(this.playSound(),this.menuBtn.selected=!1,this.menu.visible=!1)},r.createRoomSuccess=function(){this.refreshView()},r.refreshView=function(){this.nameDisplay.text=MainManager.userInfo.nick,this.coinsDisplay.text=""+MainManager.userInfo.coins,RoomManager.hasRoomInfo?(this.createBtn.enabled=!1,this.enterBtn.enabled=!0,this.enterBtn.label="进入【"+RoomManager.roomId+"】房间"):(this.createBtn.enabled=!0,this.enterBtn.enabled=!1,this.enterBtn.label="进入房间")},t}(BaseEuiView);egret.registerClass(HomeView,"HomeView");var BaseClass=function(){function e(){}var t=(__define,e);t.prototype;return e.getInstance=function(){for(var e=[],t=0;t<arguments.length;t++)e[t-0]=arguments[t];var n=this;if(!n._instance){var r=e.length;0==r?n._instance=new n:1==r?n._instance=new n(e[0]):2==r?n._instance=new n(e[0],e[1]):3==r?n._instance=new n(e[0],e[1],e[2]):4==r?n._instance=new n(e[0],e[1],e[2],e[3]):5==r&&(n._instance=new n(e[0],e[1],e[2],e[3],e[4]))}return n._instance},e}();egret.registerClass(BaseClass,"BaseClass");var EasyLoading=function(e){function t(){e.call(this),this.content=null,this.speed=.6,this.init()}__extends(t,e);var n=(__define,t),r=n.prototype;return r.init=function(){this.averageUtils=new AverageUtils,this.content=new egret.Sprite,this.content.graphics.beginFill(0,.2),this.content.graphics.drawRect(0,0,App.StageUtils.getWidth(),App.StageUtils.getHeight()),this.content.graphics.endFill(),this.content.touchEnabled=!0,this.uiImageContainer=new egret.DisplayObjectContainer,this.uiImageContainer.x=.5*this.content.width,this.uiImageContainer.y=.5*this.content.height,this.content.addChild(this.uiImageContainer),RES.getResByUrl("resource/assets/load_Reel.png",function(e){var t=new egret.Bitmap;t.texture=e,t.x=.5*-t.width,t.y=.5*-t.height,this.uiImageContainer.addChild(t)},this,RES.ResourceItem.TYPE_IMAGE)},r.showLoading=function(){App.StageUtils.getStage().addChild(this.content),App.TimerManager.doFrame(1,0,this.enterFrame,this)},r.hideLoading=function(){this.content&&this.content.parent&&(App.StageUtils.getStage().removeChild(this.content),this.uiImageContainer.rotation=0),App.TimerManager.remove(this.enterFrame,this)},r.enterFrame=function(e){this.averageUtils.push(this.speed*e),this.uiImageContainer.rotation+=this.averageUtils.getValue()},t}(BaseClass);egret.registerClass(EasyLoading,"EasyLoading");var LoadingConst=function(){function e(){}var t=(__define,e);t.prototype;return e.SetProgress=10001,e}();egret.registerClass(LoadingConst,"LoadingConst");var LoadingController=function(e){function t(){e.call(this),this.loadingView=new LoadingView(this,LayerManager.UI_Main),App.ViewManager.register(ViewConst.Loading,this.loadingView),this.registerFunc(LoadingConst.SetProgress,this.setProgress,this)}__extends(t,e);var n=(__define,t),r=n.prototype;return r.setProgress=function(e,t){this.loadingView.setProgress(e,t)},t}(BaseController);egret.registerClass(LoadingController,"LoadingController");var LoadingView=function(e){function t(t,n){e.call(this,t,n),this.skinName="resource/skins/LoadingUISkin.exml"}__extends(t,e);var n=(__define,t),r=n.prototype;return r.setProgress=function(e,t){this.txtMsg.text="资源加载中..."+e+"/"+t},t}(BaseEuiView);egret.registerClass(LoadingView,"LoadingView");var LoginConst=function(){function e(){}var t=(__define,e);t.prototype;return e.LOGIN_REQ="login.req",e.LOGIN_RESP="login.resp",e}();egret.registerClass(LoginConst,"LoginConst");var LoginController=function(e){function t(){e.call(this),this.loginView=new LoginView(this,LayerManager.UI_Main),App.ViewManager.register(ViewConst.Login,this.loginView),this.loginProxy=new LoginProxy(this),this.registerFunc(LoginConst.LOGIN_REQ,this.onLogin,this),this.registerFunc(LoginConst.LOGIN_RESP,this.loginSuccess,this)}__extends(t,e);var n=(__define,t),r=n.prototype;return r.onLogin=function(e,t){this.loginProxy.login(e,t)},r.loginSuccess=function(e){this.loginView.loginSuccess(),App.SceneManager.runScene(SceneConsts.Home)},t}(BaseController);egret.registerClass(LoginController,"LoginController");var BaseModel=function(){function e(e){this._controller=e,this._controller.setModel(this)}var t=(__define,e);t.prototype;return e}();egret.registerClass(BaseModel,"BaseModel");var LoginModel=function(e){function t(t){e.call(this,t)}__extends(t,e);var n=(__define,t);n.prototype;return t}(BaseModel);egret.registerClass(LoginModel,"LoginModel");var LoginProxy=function(e){function t(t){e.call(this,t),this.receiveServerMsg(Cmd.LOGIN,this.loginSuccess,this)}__extends(t,e);var n=(__define,t),r=n.prototype;return r.login=function(e,t){var n=App.lookupProtoMessage(Msg.DEBUG).create({openid:e}),r=App.lookupProtoMessage(Msg.WECHAT).create({code:t}),i={head:App.Head,debug:n,wechat:r};this.sendSocketCBMsg(Cmd.LOGIN,i)},r.loginSuccess=function(e){MainManager.setUserInfo(e.player),this.applyFunc(LoginConst.LOGIN_RESP,e)},t}(BaseProxy);egret.registerClass(LoginProxy,"LoginProxy");var LoginView=function(e){function t(t,n){e.call(this,t,n),this.skinName="resource/skins/LoginSkin.exml"}__extends(t,e);var n=(__define,t),r=n.prototype;return r.initUI=function(){e.prototype.initUI.call(this),this.passwordInput.displayAsPassword=!0,this.loginBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onLogin,this)},r.initData=function(){e.prototype.initData.call(this)},r.open=function(){for(var t=[],n=0;n<arguments.length;n++)t[n-0]=arguments[n];e.prototype.open.call(this,t)},r.close=function(){for(var t=[],n=0;n<arguments.length;n++)t[n-0]=arguments[n];e.prototype.close.call(this,t)},r.onLogin=function(){var e=this.usernameInput.text,t=this.passwordInput.text;if(null==e||0==e.length)return void App.TipsUtils.showCenter("账号密码不能为空");if(null==t||0==t.length)return void App.TipsUtils.showCenter("账号密码不能为空");var n="213sefwe",r="344";this.applyFunc(LoginConst.LOGIN_REQ,n,r)},r.loginSuccess=function(){App.TipsUtils.showCenter("登录成功")},t}(BaseEuiView);egret.registerClass(LoginView,"LoginView");var RoomController=function(e){function t(){e.call(this),this.proxy=new RoomProxy(this),this.roomView=new RoomView(this,LayerManager.Room_Main),App.ViewManager.register(ViewConst.Room,this.roomView),this.roomUIView=new RoomUIView(this,LayerManager.Room_Main),App.ViewManager.register(ViewConst.RoomUI,this.roomUIView),this.registerFunc(HomeConst.ROOM_DISMISS_REQ,this.onDismiss,this),this.registerFunc(HomeConst.ROOM_LEAVE_REQ,this.onLeave,this),this.registerFunc(HomeConst.ROOM_PLAYERS_GET_REQ,this.getPlayers,this),this.registerFunc(HomeConst.ROOM_DISMISS_RESP,this.dismissResp,this),this.registerFunc(HomeConst.ROOM_LEAVE_RESP,this.leaveResp,this),this.registerFunc(HomeConst.ROOM_PLAYERS_GET_RESP,this.onGetPlayersResp,this)}__extends(t,e);var n=(__define,t),r=n.prototype;return r.onDismiss=function(){this.proxy.dismissRoom()},r.onLeave=function(){this.proxy.leaveRoom()},r.dismissResp=function(){App.TipsUtils.showCenter("解释房间"),App.SceneManager.runScene(SceneConsts.Home)},r.getPlayers=function(){this.proxy.getRoomPlayersInfo(RoomManager.playerIds)},r.leaveResp=function(e){App.TipsUtils.showCenter("离开房间"),App.SceneManager.runScene(SceneConsts.Home)},r.onGetPlayersResp=function(e){var t=e.playerInfo,n="";RoomManager.clearPlayers();for(var r=0;r<t.length;r++)n+=t[r].nick+" ",RoomManager.addPlayer(new PlayerInfo(t[r]));App.TipsUtils.showCenter("牌友: "+n)},t}(BaseController);egret.registerClass(RoomController,"RoomController");var RoomProxy=function(e){function t(t){e.call(this,t),this.receiveServerMsg(Cmd.ROOM_DISMISS,this.dismissRoomSuccess,this),this.receiveServerMsg(Cmd.ROOM_LEAVE,this.leaveRoomSuccess,this),this.receiveServerMsg(Cmd.ROOM_PLAYER_INFO_GET,this.getRoomPlayersInfoSuccess,this)}__extends(t,e);var n=(__define,t),r=n.prototype;return r.dismissRoom=function(){var e={head:App.Head};RoomManager.clearRoomInfo(),this.sendSocketCBMsg(Cmd.ROOM_LEAVE,e)},r.leaveRoom=function(){var e={head:App.Head};this.sendSocketCBMsg(Cmd.ROOM_LEAVE,e)},r.getRoomPlayersInfo=function(e){var t={head:App.Head,uid:e};this.sendSocketCBMsg(Cmd.ROOM_PLAYER_INFO_GET,t)},r.dismissRoomSuccess=function(e){this.applyFunc(HomeConst.ROOM_DISMISS_RESP,e)},r.leaveRoomSuccess=function(e){this.applyFunc(HomeConst.ROOM_LEAVE_RESP,e)},r.getRoomPlayersInfoSuccess=function(e){this.applyFunc(HomeConst.ROOM_PLAYERS_GET_RESP,e)},t}(BaseProxy);egret.registerClass(RoomProxy,"RoomProxy");var RoomUIView=function(e){function t(t,n){e.call(this,t,n),this.skinName="resource/skins/RoomUISkin.exml"}__extends(t,e);var n=(__define,t),r=n.prototype;return r.initUI=function(){e.prototype.initUI.call(this),this.dismissBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.dismissBtnClickHandler,this),this.leaveBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.leaveClickHandler,this),this.sendBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.sendClickHandler,this)},r.open=function(){for(var t=[],n=0;n<arguments.length;n++)t[n-0]=arguments[n];e.prototype.open.call(this,t)},r.dismissBtnClickHandler=function(e){this.applyFunc(HomeConst.ROOM_DISMISS_REQ)},r.leaveClickHandler=function(e){this.applyFunc(HomeConst.ROOM_LEAVE_REQ)},r.sendClickHandler=function(e){""!=this.msgInput.text&&null!=this.msgInput.text&&App.TipsUtils.showCenter(this.msgInput.text)},r.refreshView=function(){for(var e,t=RoomManager.players,n=0;n<t.length;n++)switch(e=t[n],e.seatId){case 0:this.topPlayerLabel.text=e.nick;break;case 1:this.leftPlayerLabel.text=e.nick;break;case 2:this.bottomPlayerLabel.text=e.nick;break;case 3:this.rightPlayerLabel.text=e.nick}},t}(BaseEuiView);egret.registerClass(RoomUIView,"RoomUIView");var RoomView=function(e){function t(t,n){e.call(this,t,n),this.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClickItem,this)}__extends(t,e);var n=(__define,t),r=n.prototype;return r.initUI=function(){e.prototype.initUI.call(this),this.bbar=new BMahjongBar,this.bbar.x=100,this.bbar.y=App.StageUtils.getHeight()-100,this.addChild(this.bbar)},r.open=function(){for(var t=[],n=0;n<arguments.length;n++)t[n-0]=arguments[n];e.prototype.open.call(this,t),this.refreshView(MahjongManager.random(20))},r.refreshView=function(e){this.bbar.data=e},r.onClickItem=function(e){e.target instanceof MahjongItem&&this.bbar.switchItem(e.target)},t}(BaseEuiView);egret.registerClass(RoomView,"RoomView");var ServerChooseController=function(e){function t(){e.call(this),this.chooseView=new ServerChooseView(this,LayerManager.UI_Main),App.ViewManager.register(ViewConst.ServerChoose,this.chooseView)}__extends(t,e);var n=(__define,t);n.prototype;return t}(BaseController);egret.registerClass(ServerChooseController,"ServerChooseController");var ServerChooseView=function(e){function t(t,n){e.call(this,t,n),this.skinName="resource/skins/ServerChooseSkin.exml"}__extends(t,e);var n=(__define,t),r=n.prototype;return r.initUI=function(){e.prototype.initUI.call(this),this.serverList.itemRenderer=ServerItemRenderer,this.serverList.addEventListener(egret.TouchEvent.TOUCH_TAP,this.listItemClickHandler,this)},r.listItemClickHandler=function(e){Log.trace("list:",this.serverList.selectedItem);var t=this.serverList.selectedItem;void 0!=t&&null!=t&&(App.Socket.initServer(t.ip,t.port,new ByteArrayMsgByProtobuf),App.Socket.connect(),App.MessageCenter.addListener(SocketConst.SOCKET_CONNECT,function(){Log.trace("[Startup]与服务器连接上"),App.ViewManager.close(ViewConst.ServerChoose),0==t.seletedIdex?App.ViewManager.open(ViewConst.Home):App.ViewManager.open(ViewConst.Login)},this),App.MessageCenter.addListener(SocketConst.SOCKET_RECONNECT,function(){Log.trace("[Startup]与服务器重新连接上")},this),App.MessageCenter.addListener(SocketConst.SOCKET_START_RECONNECT,function(){Log.trace("[Startup]开始与服务器重新连接")},this),App.MessageCenter.addListener(SocketConst.SOCKET_CLOSE,function(){Log.trace("[Startup]与服务器断开连接")},this),App.MessageCenter.addListener(SocketConst.SOCKET_NOCONNECT,function(){Log.trace("[Startup]服务器连接不上")},this),App.MessageCenter.addListener("10001",function(e){Log.trace("[Startup]收到服务器消息:",e)},this))},t}(BaseEuiView);egret.registerClass(ServerChooseView,"ServerChooseView");var ServerItemRenderer=function(e){function t(){e.call(this),this.skinName="resource/skins/ServerItemRendererSkin.exml",this.touchChildren=!0}__extends(t,e);var n=(__define,t),r=n.prototype;return r.dataChanged=function(){this.nameLbl.text=this.data.label,this.ipLbl.text=this.data.ip,this.portLbl.text=this.data.port},t}(eui.ItemRenderer);egret.registerClass(ServerItemRenderer,"ServerItemRenderer");var CenterTips=function(){function e(){this._status=0,this._container=new egret.Sprite,this._txt=new egret.TextField,this._txt.x=this._txt.y=10,this._txt.textColor=16777215,this._txt.textAlign=egret.HorizontalAlign.CENTER,this._container.addChild(this._txt)}var t=(__define,e),n=t.prototype;return n.getStatus=function(){return this._status},n.show=function(e,t,n,r){if(null!=t){this._status=1,this._txt.text=e;var i=this._txt.width,s=this._txt.height;this._container.alpha=1,this._container.graphics.clear(),this._container.graphics.beginFill(0,.5),this._container.graphics.drawRoundRect(0,0,i+20,s+20,5,5),this._container.graphics.endFill(),this._container.x=.5*(t.width-this._container.width),this._container.y=.5*(t.height-this._container.height),t.addChild(this._container),n&&this.hide(r)}else Log.error("parent should not be null")},n.hide=function(e){var t=(this._container.y,Math.max(this._container.y-Math.floor(100*Math.random())-40,0)),n=egret.Tween.get(this._container);n.to({y:t},1e3).call(function(){}).wait(2).to({alpha:.5},1e3).call(function(){App.DisplayUtils.removeFromParent(this)}),egret.setTimeout(function(e){e()},this,3e3,this.reset)},n.reset=function(){this._status=0},e}();egret.registerClass(CenterTips,"CenterTips",["BaseTips"]);var TipsController=function(){function e(){}var t=(__define,e);t.prototype;return e}();egret.registerClass(TipsController,"TipsController");var BaseScene=function(){function e(){this._layers=new Array}var t=(__define,e),n=t.prototype;return n.onEnter=function(){},n.onExit=function(){App.ViewManager.closeAll(),this.removeAllLayer()
},n.addLayer=function(e){e instanceof BaseSpriteLayer?(App.StageUtils.getStage().addChild(e),this._layers.push(e)):e instanceof BaseEuiLayer&&(App.StageUtils.getUIStage().addChild(e),this._layers.push(e))},n.addLayerAt=function(e,t){e instanceof BaseSpriteLayer?(App.StageUtils.getStage().addChildAt(e,t),this._layers.push(e)):e instanceof BaseEuiLayer&&(App.StageUtils.getUIStage().addChildAt(e,t),this._layers.push(e))},n.removeLayer=function(e){e instanceof BaseSpriteLayer?(App.StageUtils.getStage().removeChild(e),this._layers.splice(this._layers.indexOf(e),1)):e instanceof BaseEuiLayer&&(App.StageUtils.getUIStage().removeChild(e),this._layers.splice(this._layers.indexOf(e),1))},n.layerRemoveAllChild=function(e){e instanceof BaseSpriteLayer?e.removeChildren():e instanceof BaseEuiLayer&&e.removeChildren()},n.removeAllLayer=function(){for(;this._layers.length;){var e=this._layers[0];this.layerRemoveAllChild(e),this.removeLayer(e)}},e}();egret.registerClass(BaseScene,"BaseScene");var EnterScene=function(e){function t(){e.call(this)}__extends(t,e);var n=(__define,t),r=n.prototype;return r.onEnter=function(){e.prototype.onEnter.call(this),this.addLayer(LayerManager.UI_Main),this.addLayer(LayerManager.UI_Popup),this.addLayer(LayerManager.UI_Message),this.addLayer(LayerManager.UI_Tips);var t=new eui.Rect;t.fillColor=13421772,t.percentHeight=100,t.percentWidth=100,LayerManager.UI_Main.addChild(t),App.ViewManager.open(ViewConst.ServerChoose),App.SoundManager.playBg("sound_bg")},r.onExit=function(){e.prototype.onExit.call(this)},t}(BaseScene);egret.registerClass(EnterScene,"EnterScene");var HomeScene=function(e){function t(){e.call(this)}__extends(t,e);var n=(__define,t),r=n.prototype;return r.onEnter=function(){e.prototype.onEnter.call(this),this.addLayer(LayerManager.UI_Main),this.addLayer(LayerManager.UI_Popup),this.addLayer(LayerManager.UI_Message),this.addLayer(LayerManager.UI_Tips);var t=new eui.Rect;t.fillColor=7911743,t.percentHeight=100,t.percentWidth=100,LayerManager.UI_Main.addChild(t),App.ViewManager.open(ViewConst.Home),App.SoundManager.playBg("sound_bg")},r.onExit=function(){e.prototype.onExit.call(this)},t}(BaseScene);egret.registerClass(HomeScene,"HomeScene");var BaseSpriteLayer=function(e){function t(){e.call(this),this.touchEnabled=!1}__extends(t,e);var n=(__define,t);n.prototype;return t}(egret.DisplayObjectContainer);egret.registerClass(BaseSpriteLayer,"BaseSpriteLayer");var BaseEuiLayer=function(e){function t(){e.call(this),this.percentWidth=100,this.percentHeight=100,this.touchEnabled=!1}__extends(t,e);var n=(__define,t);n.prototype;return t}(eui.Group);egret.registerClass(BaseEuiLayer,"BaseEuiLayer");var LayerManager=function(){function e(){}var t=(__define,e);t.prototype;return e.Game_Bg=new BaseSpriteLayer,e.Room_Main=new BaseEuiLayer,e.UI_Main=new BaseEuiLayer,e.UI_Popup=new BaseEuiLayer,e.UI_Message=new BaseEuiLayer,e.UI_Tips=new BaseEuiLayer,e}();egret.registerClass(LayerManager,"LayerManager");var LoadingScene=function(e){function t(){e.call(this)}__extends(t,e);var n=(__define,t),r=n.prototype;return r.onEnter=function(){e.prototype.onEnter.call(this),this.addLayer(LayerManager.UI_Main),App.ViewManager.open(ViewConst.Loading)},r.onExit=function(){e.prototype.onExit.call(this)},t}(BaseScene);egret.registerClass(LoadingScene,"LoadingScene");var RoomScene=function(e){function t(){e.call(this)}__extends(t,e);var n=(__define,t),r=n.prototype;return r.onEnter=function(){e.prototype.onEnter.call(this),this.addLayerAt(LayerManager.Room_Main,0),this.addLayer(LayerManager.UI_Tips),App.ViewManager.open(ViewConst.RoomUI),App.ViewManager.open(ViewConst.Room),App.SoundManager.playBg("sound_bg")},r.onExit=function(){e.prototype.onExit.call(this)},t}(BaseScene);egret.registerClass(RoomScene,"RoomScene");var App=function(){function e(){}var t=__define,n=e;n.prototype;return e.Init=function(){e.GlobalData=RES.getRes("global"),e.DebugUtils.isOpen(e.GlobalData.IsDebug),e.DebugUtils.setThreshold(5),e.Http.initServer(e.GlobalData.HttpSerever),protobuf.load("resource/proto/package.proto?"+Math.random()).then(function(t){e.ProtoRoot=t}),Log.trace(e.GlobalData.ReqConfig,e.GlobalData.RespConfig),e.ReqConfig=RES.getRes(e.GlobalData.ReqConfig),e.RespConfig=RES.getRes(e.GlobalData.RespConfig),e.Socket.initServer(e.GlobalData.SocketServer,e.GlobalData.SocketPort,new ByteArrayMsgByProtobuf)},e.lookupProtoMessage=function(t){return e.ProtoRoot.lookup(t)},t(e,"Head",function(){return null==this._head&&(this._head=e.lookupProtoMessage(Msg.Head).create({uid:12,err:0,errmsg:""})),this._head}),t(e,"Http",function(){return Http.getInstance()}),t(e,"Socket",function(){return Socket.getInstance()}),t(e,"EasyLoading",function(){return EasyLoading.getInstance()}),t(e,"ResVersionManager",function(){return ResVersionManager.getInstance()}),t(e,"DebugUtils",function(){return DebugUtils.getInstance()}),t(e,"MessageCenter",function(){return MessageCenter.getInstance(0)}),t(e,"TimerManager",function(){return TimerManager.getInstance()}),t(e,"DeviceUtils",function(){return DeviceUtils.getInstance()}),t(e,"DisplayUtils",function(){return DisplayUtils.getInstance()}),t(e,"StageUtils",function(){return StageUtils.getInstance()}),t(e,"ResourceUtils",function(){return ResourceUtils.getInstance()}),t(e,"SoundManager",function(){return SoundManager.getInstance()}),t(e,"ControllerManager",function(){return CtrlManager.getInstance()}),t(e,"ViewManager",function(){return ViewManager.getInstance()}),t(e,"SceneManager",function(){return SceneManager.getInstance()}),t(e,"TipsUtils",function(){return TipsUtils.getInstance()}),e.ProxyUserFlag="",e.GlobalData=null,e.ProtoFile=null,e.ProtoConfig=null,e}();egret.registerClass(App,"App");var AssetAdapter=function(){function e(){}var t=(__define,e),n=t.prototype;return n.getAsset=function(e,t,n){function r(r){t.call(n,r,e)}if(RES.hasRes(e)){var i=RES.getRes(e);i?r(i):RES.getResAsync(e,r,this)}else RES.getResByUrl(e,r,this,RES.ResourceItem.TYPE_IMAGE)},e}();egret.registerClass(AssetAdapter,"AssetAdapter",["eui.IAssetAdapter"]);var ThemeAdapter=function(){function e(){}var t=(__define,e),n=t.prototype;return n.getTheme=function(e,t,n,r){function i(e){t.call(r,e)}function s(t){t.resItem.url==e&&(RES.removeEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,s,null),n.call(r))}RES.addEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,s,null),RES.getResByUrl(e,i,this,RES.ResourceItem.TYPE_TEXT)},e}();egret.registerClass(ThemeAdapter,"ThemeAdapter",["eui.IThemeAdapter"]);var CtrlManager=function(e){function t(){e.call(this),this._modules={}}__extends(t,e);var n=(__define,t),r=n.prototype;return r.clear=function(){this._modules={}},r.register=function(e,t){this.isExists(e)||(this._modules[e]=t)},r.unregister=function(e){this.isExists(e)&&(this._modules[e]=null,delete this._modules[e])},r.isExists=function(e){return null!=this._modules[e]},r.applyFunc=function(e,t){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];var i=this._modules[e];if(i){for(var s=[],o=1;o<arguments.length;o++)s[o-1]=arguments[o];return i.applyFunc.apply(i,s)}return Log.trace("模块"+e+"不存在"),null},r.getControllerModel=function(e){var t=this._modules[e];return t?t.getModel():null},t}(BaseClass);egret.registerClass(CtrlManager,"CtrlManager");var ViewManager=function(e){function t(){e.call(this),this._views={},this._opens=[]}__extends(t,e);var n=(__define,t),r=n.prototype;return r.clear=function(){this.closeAll(),this._views={}},r.register=function(e,t){null!=t&&(this._views[e]||(this._views[e]=t))},r.unregister=function(e){this._views[e]&&(this._views[e]=null,delete this._views[e])},r.destroy=function(e,t){void 0===t&&(t=null);var n=this.getView(e);n&&(this.unregister(e),n.destroy(),n=null),this.register(e,t)},r.open=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];var r=this.getView(e);return null==r?void Log.trace("UI_"+e+"不存在"):r.isShow()?(r.open.apply(r,t),r):(r.isInit()?(r.addToParent(),r.open.apply(r,t)):(App.EasyLoading.showLoading(),r.loadResource(function(){r.addToParent(),r.setVisible(!1)}.bind(this),function(){r.initUI(),r.initData(),r.open.apply(r,t),r.setVisible(!0),App.EasyLoading.hideLoading()}.bind(this))),this._opens.push(e),r)},r.close=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];if(this.isShow(e)){var r=this.getView(e);if(null!=r){var i=this._opens.indexOf(e);e>=0&&this._opens.splice(i,1),r.removeFromParent(),r.close.apply(r,t)}}},r.closeView=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];for(var r=Object.keys(this._views),i=0,s=r.length;s>i;i++){var o=parseInt(r[i]);if(this._views[o]==e)return void this.close(o,t)}},r.getView=function(e){return this._views[e]},r.closeAll=function(){for(;this._opens.length;)this.close(this._opens[0])},r.currOpenNum=function(){return this._opens.length},r.isShow=function(e){return-1!=this._opens.indexOf(e)},t}(BaseClass);egret.registerClass(ViewManager,"ViewManager");var BaseSpriteView=function(e){function t(t,n){e.call(this),this._resources=null,this._controller=t,this._myParent=n,this._isInit=!1,App.StageUtils.getStage().addEventListener(egret.Event.RESIZE,this.onResize,this)}__extends(t,e);var n=__define,r=t,i=r.prototype;return i.setResources=function(e){this._resources=e},n(i,"myParent",function(){return this._myParent}),i.isInit=function(){return this._isInit},i.applyFunc=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];return this._controller.applyFunc.apply(this._controller,arguments)},i.applyControllerFunc=function(e,t){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];return this._controller.applyControllerFunc.apply(this._controller,arguments)},i.isShow=function(){return null!=this.stage&&this.visible},i.addToParent=function(){this._myParent.addChild(this)},i.removeFromParent=function(){App.DisplayUtils.removeFromParent(this)},i.initUI=function(){this._isInit=!0},i.initData=function(){},i.open=function(){for(var e=[],t=0;t<arguments.length;t++)e[t-0]=arguments[t]},i.close=function(){for(var e=[],t=0;t<arguments.length;t++)e[t-0]=arguments[t]},i.destroy=function(){this._controller=null,this._myParent=null,this._resources=null},i.onResize=function(){},i.loadResource=function(e,t){this._resources&&this._resources.length>0?App.ResourceUtils.loadResource(this._resources,[],function(){e(),t()},null,this):(e(),t())},i.setVisible=function(e){this.visible=e},t}(egret.DisplayObjectContainer);egret.registerClass(BaseSpriteView,"BaseSpriteView",["IBaseView"]);var DynamicChange=function(){function e(){this._dataCache=[],this._pUpdate=new ProxyUpdate(this._dataCache)}var t=__define,n=e,r=n.prototype;return t(r,"pUpdate",function(){return this._pUpdate}),r.getCacheData=function(e){return this._dataCache[e]?this._dataCache[e]:null},r.clearCache=function(){for(var e=Object.keys(this._dataCache),t=0,n=e.length;n>t;t++){var r=e[t];this._dataCache[r]=null,delete this._dataCache[r]}},r.getCacheKeyInfos=function(){for(var e=[],t=Object.keys(this._dataCache),n=0,r=t.length;r>n;n++){var i=t[n],s=this._dataCache[i];e.push(s)}return e},r.isCache=function(e){return this._dataCache[e]},e}();egret.registerClass(DynamicChange,"DynamicChange");var ProxyUpdate=function(){function e(e){this._cache=e}var t=(__define,e),n=t.prototype;return n.isArray=function(e){return e instanceof Array},n.isObject=function(e){return e.indexOf("object")>-1},n.isNormal=function(e){var t=e.indexOf("@")>-1,n=e.indexOf(".")>-1,r=e.indexOf("_")>-1;return!t&&!n&&!r},n.isAddToArray=function(e){return"@a"==e},n.isRemoveToArray=function(e){var t=e.split("_");return t.length<=3&&"@d"==t[0]},n.isFilter=function(e){var t=e.split("_");return"@f"==t[0]},n.isNumeric=function(e){return parseFloat(e).toString()==e.toString()},n._updateObject=function(e,t,n){var r=e.split(".");"@a"==r[0]||"@s"==r[0]?n[r[1]]=t:"@d"==r[0]&&delete n[r[1]]},n._getFilterObject=function(e,t){if(t){var n=e.split("_");if(3==n.length&&"@f"==n[0]&&this.isArray(t))for(var r=n[1],i=n[2],s=0;s<t.length;s++){var o=t[s];if(3==n.length&&this.isObject(o.toString())){var a=o[r];if(a&&("@"==i[0]&&(i=i.replace("@","")),i==a))return o}}}return null},n._addObjectToArray=function(e,t){if(this.isArray(t))for(var n=0;n<t.length;n++)e.push(t[n]);else e.push(t)},n._removeObjectFromArray=function(e,t,n){var r=t.split("_");if(r.length<=3&&"@d"==r[0]&&this.isArray(e))for(var i=e.length,s=i-1;s>=0;s--){var o=e[s];if(3==r.length){if(o.hasOwnProperty(r[1])){var a=r[2];"@"==a[0]&&(a=a.replace("@","")),a==o[r[1]]&&e.splice(s,1)}}else 2==r.length&&o.hasOwnProperty(r[1])?n==o[r[1]]&&e.splice(s,1):1==r.length&&n==o&&e.splice(s,1)}},n.update=function(e,t){if(this._cache[e]=t,t.hasOwnProperty("c"))for(var n=t.c,r=Object.keys(n),i=0,s=r.length;s>i;i++){var o=r[i];this._cache[o]&&(this._update(this._cache[o],n[o]),App.MessageCenter.dispatch(o+"_HttpUpdate"))}},n._update=function(e,t){if(e&&t&&this.isObject(t.toString()))for(var n=Object.keys(t),r=0,i=n.length;i>r;r++){var s=n[r],o=t[s];if(this.isNormal(s)&&this.isObject(o.toString()))e.hasOwnProperty(s)&&this._update(e[s],o);else if(this.isNormal(s)&&this.isNumeric(o)){var a=e[s];e[s]=a+o}else if(this.isNormal(s))e[s]=o;else if(this.isAddToArray(s))this._addObjectToArray(e,o);else if(this.isRemoveToArray(s))this._removeObjectFromArray(e,s,o);else if(this.isFilter(s)){var c=this._getFilterObject(s,e);c&&this._update(c,o)}else this._updateObject(s,o,e)}},e}();egret.registerClass(ProxyUpdate,"ProxyUpdate");var Http=function(e){function t(){e.call(this),this._data=new DynamicChange,this._cache=[],this._request=new egret.URLRequest,this._request.method=egret.URLRequestMethod.POST,this._urlLoader=new egret.URLLoader,this._urlLoader.addEventListener(egret.IOErrorEvent.IO_ERROR,this.onError,this)}__extends(t,e);var n=__define,r=t,i=r.prototype;return i.initServer=function(e){this._serverUrl=e},n(i,"Data",function(){return this._data}),i.onError=function(e){this.nextPost()},i.send=function(e,t){this._cache.push([e,t]),this.post()},i.post=function(){if(!this._isRequesting&&0!=this._cache.length){var e=this._cache.shift(),t=e[0],n=e[1];this._type=t,this._request.url=this._serverUrl,this._request.data=n,this._urlLoader.addEventListener(egret.Event.COMPLETE,this.onLoaderComplete,this),this._urlLoader.load(this._request),this._isRequesting=!0}},i.onLoaderComplete=function(e){this._urlLoader.removeEventListener(egret.Event.COMPLETE,this.onLoaderComplete,this);var t=JSON.parse(this._urlLoader.data);t.hasOwnProperty("s")&&0!=t.s?Log.trace("Http错误:"+t.s):(this._data.pUpdate.update(this._type,t),App.MessageCenter.dispatch(this._type,t)),this.nextPost()},i.nextPost=function(){this._isRequesting=!1,this.post()},t}(BaseClass);egret.registerClass(Http,"Http");var ByteArrayMsg=function(){function e(){this._msgBuffer=new egret.ByteArray}var t=(__define,e),n=t.prototype;return n.receive=function(e){Log.trace("receive data"),e.readBytes(this._msgBuffer);var t=this.decode(this._msgBuffer);t&&App.MessageCenter.dispatch(t.key,t.body),0==this._msgBuffer.bytesAvailable&&this._msgBuffer.clear()},n.send=function(e,t){var n=this.encode(t);n&&(n.position=0,e.writeBytes(n,0,n.bytesAvailable))},n.decode=function(e){return Log.trace("decode需要子类重写，根据项目的协议结构解析"),null},n.encode=function(e){return Log.trace("encode需要子类重写，根据项目的协议结构解析"),null},e}();egret.registerClass(ByteArrayMsg,"ByteArrayMsg",["BaseMsg"]);var ByteArrayMsgByProtobuf=function(e){function t(){e.call(this),this.msgClass=null,this.reqConfig=null,this.respConfig=null,this.reqConfigSymmetry=null,this.respConfigSymmetry=null,this.msgClass=null,this.reqConfig=null,this.respConfig=null,this.reqConfigSymmetry=null,this.respConfigSymmetry=null,this.msgClass={},this.reqConfig=App.ReqConfig,this.respConfig=App.RespConfig,this.reqConfigSymmetry={},this.respConfigSymmetry={};for(var t=Object.keys(this.reqConfig),n=0,r=t.length;r>n;n++){var i=t[n],s=this.reqConfig[i];this.reqConfigSymmetry[i]=s}t=Object.keys(this.respConfig);for(var n=0,r=t.length;r>n;n++){var i=t[n],s=this.respConfig[i];this.respConfigSymmetry[i]=s}}__extends(t,e);var n=(__define,t),r=n.prototype;return r.getMessage=function(e){var t=this.msgClass[e];if((null==t||void 0==t)&&(t=App.lookupProtoMessage(e),this.msgClass[e]=t),null==t)throw new Error("不存在name="+e+"的Message");return t},r.getReqMsg=function(e){return this.reqConfig[e]},r.getRespMsg=function(e){return this.respConfig[e]},r.receive=function(e){var t=e.readHead(),n=e.readBody(),r=(t.readInt(),t.readInt()),i=(t.readByte(),{});i.cmd=r;var s=this.getMessage(this.getRespMsg(i.cmd));return i.body=s.decode(n),Log.trace(s,i.body,i.body.head),void 0==i.body||void 0==i.body.head?void App.TipsUtils.showCenter("数据错误:"+this.getErrMsg(i)):void 0!=i.body.head.err&&0!=i.body.head.err?void App.TipsUtils.showCenter("错误码："+i.body.head.err):(i&&App.MessageCenter.dispatch(i.cmd,i.body),void e.clear())},r.getErrMsg=function(e){return void 0==e.body?"pb解析错误":void 0==e.body.head?"pb缺少头部信息":(null==e.body.head,"pb解码失败")},r.decode=function(e){var t=e,n=t.readInt();t.readInt(),t.readByte();if(t.bytesAvailable>=n){var r=new egret.ByteArray;t.readBytes(r,0,n);var i={};return i}return null},r.encode=function(e){var t=e.cmd,n=this.getMessage(this.getReqMsg(e.cmd)),r=n.create(e.body);App.DebugUtils.start("Protobuf Encode");var i=n.encode(r).finish();App.DebugUtils.stop("Protobuf Encode"),Log.trace("发送数据：","["+t+" "+e.cmd+" "+i.length+"]",e.body);var s=new egret.ByteArray;s.writeInt(i.length),s.writeInt(t),s.writeByte(0),s.writeBytes(i);var o=n.decode(i);return Log.trace(o),s},t}(ByteArrayMsg);egret.registerClass(ByteArrayMsgByProtobuf,"ByteArrayMsgByProtobuf");var Socket=function(e){function t(){e.call(this),this._needReconnect=!1,this._maxReconnectCount=10,this._reconnectCount=0}__extends(t,e);var n=(__define,t),r=n.prototype;return r.addEvents=function(){this._socket.addEventListener(egret.ProgressEvent.SOCKET_DATA,this.onReceiveMessage,this),this._socket.addEventListener(egret.Event.CONNECT,this.onSocketOpen,this),this._socket.addEventListener(egret.Event.CLOSE,this.onSocketClose,this),this._socket.addEventListener(egret.IOErrorEvent.IO_ERROR,this.onSocketError,this)},r.removeEvents=function(){this._socket.removeEventListener(egret.ProgressEvent.SOCKET_DATA,this.onReceiveMessage,this),this._socket.removeEventListener(egret.Event.CONNECT,this.onSocketOpen,this),this._socket.removeEventListener(egret.Event.CLOSE,this.onSocketClose,this),this._socket.removeEventListener(egret.IOErrorEvent.IO_ERROR,this.onSocketError,this)},r.onSocketOpen=function(){this._reconnectCount=0,this._connectFlag?App.MessageCenter.dispatch(SocketConst.SOCKET_RECONNECT):App.MessageCenter.dispatch(SocketConst.SOCKET_CONNECT),this._connectFlag=!0,this._isConnecting=!0},r.onSocketClose=function(){App.TipsUtils.showCenter("服务器断开连接"),this._needReconnect?(this.reconnect(),App.MessageCenter.dispatch(SocketConst.SOCKET_START_RECONNECT)):App.MessageCenter.dispatch(SocketConst.SOCKET_CLOSE),this._isConnecting=!1},r.onSocketError=function(){App.TipsUtils.showCenter("服务器连接错误"),this._needReconnect?this.reconnect():App.MessageCenter.dispatch(SocketConst.SOCKET_NOCONNECT),this._isConnecting=!1},r.onReceiveMessage=function(e){this._msg.receive(this._socket)},r.initServer=function(e,t,n){this._host=e,this._port=t,this._msg=n},r.connect=function(){return App.DeviceUtils.IsHtml5&&!window.WebSocket?void Log.trace("不支持WebSocket"):(this._socket=new egret.WebSocket,this._msg instanceof ByteArrayMsg&&(this._socket.type=egret.WebSocket.TYPE_BINARY),Log.trace("WebSocket: "+this._host+":"+this._port),this._socket.connect(this._host,this._port),void this.addEvents())},r.reconnect=function(){this.close(),this._reconnectCount++,this._reconnectCount<this._maxReconnectCount?this.connect():(this._reconnectCount=0,this._connectFlag?App.MessageCenter.dispatch(SocketConst.SOCKET_CLOSE):App.MessageCenter.dispatch(SocketConst.SOCKET_NOCONNECT))},r.send=function(e){this._msg.send(this._socket,e)},r.close=function(){this.removeEvents(),this._socket.close(),this._socket=null,this._isConnecting=!1,this._connectFlag=!1},r.isConnecting=function(){return this._isConnecting},r.debugInfo=function(e){App.MessageCenter.dispatch(SocketConst.SOCKET_DEBUG_INFO,e)},t}(BaseClass);egret.registerClass(Socket,"Socket");var SocketConst=function(){function e(){}var t=(__define,e);t.prototype;return e.SOCKET_CONNECT="SOCKET_CONNECT",e.SOCKET_RECONNECT="SOCKET_RECONNECT",e.SOCKET_START_RECONNECT="SOCKET_START_RECONNECT",e.SOCKET_CLOSE="SOCKET_CLOSE",e.SOCKET_DATA="SOCKET_DATA",e.SOCKET_NOCONNECT="SOCKET_NOCONNECT",e.SOCKET_DEBUG_INFO="SOCKET_DEBUG_INFO",e}();egret.registerClass(SocketConst,"SocketConst");var UTFMsg=function(){function e(){}var t=(__define,e),n=t.prototype;return n.receive=function(e){var t=e.readUTF(),n=this.decode(t);n&&App.MessageCenter.dispatch(n.key,n.body)},n.send=function(e,t){var n=this.encode(t);n&&(e.type=egret.WebSocket.TYPE_STRING,e.writeUTF(n))},n.decode=function(e){return Log.trace("decode需要子类重写，根据项目的协议结构解析"),null},n.encode=function(e){return Log.trace("encode需要子类重写，根据项目的协议结构解析"),null},e}();egret.registerClass(UTFMsg,"UTFMsg",["BaseMsg"]);var UTFMsgByJson=function(e){function t(){e.call(this)}__extends(t,e);var n=(__define,t),r=n.prototype;return r.decode=function(e){return JSON.parse(e)},r.encode=function(e){return JSON.stringify(e)},t}(UTFMsg);egret.registerClass(UTFMsgByJson,"UTFMsgByJson");var SceneManager=function(e){function t(){e.call(this),this._scenes={}}__extends(t,e);var n=(__define,t),r=n.prototype;return r.clear=function(){var e=this._scenes[this._currScene];e&&(e.onExit(),this._currScene=void 0),this._scenes={}},r.register=function(e,t){this._scenes[e]=t},r.runScene=function(e){var t=this._scenes[e];if(null==t)return void Log.trace("场景"+e+"不存在");var n=this._scenes[this._currScene];n&&n.onExit(),t.onEnter(),this._currScene=e},r.getCurrScene=function(){return this._currScene},t}(BaseClass);egret.registerClass(SceneManager,"SceneManager");var BaseSound=function(){function e(){this._cache={},this._loadingCache=new Array,App.TimerManager.doTimer(6e4,0,this.dealSoundTimer,this)}var t=(__define,e),n=t.prototype;return n.dealSoundTimer=function(){for(var e=egret.getTimer(),t=Object.keys(this._cache),n=0,r=t.length;r>n;n++){var i=t[n];this.checkCanClear(i)&&e-this._cache[i]>=SoundManager.CLEAR_TIME&&(delete this._cache[i],RES.destroyRes(i))}},n.getSound=function(e){var t=RES.getRes(e);if(t)this._cache[e]&&(this._cache[e]=egret.getTimer());else{if(-1!=this._loadingCache.indexOf(e))return null;this._loadingCache.push(e),RES.getResAsync(e,this.onResourceLoadComplete,this)}return t},n.onResourceLoadComplete=function(e,t){var n=this._loadingCache.indexOf(t);-1!=n&&(this._loadingCache.splice(n,1),this._cache[t]=egret.getTimer(),this.loadedPlay(t))},n.loadedPlay=function(e){},n.checkCanClear=function(e){return!0},e}();egret.registerClass(BaseSound,"BaseSound");var SoundBg=function(e){function t(){e.call(this),this._currBg=""}__extends(t,e);var n=(__define,t),r=n.prototype;return r.stop=function(){this._currSoundChannel&&this._currSoundChannel.stop(),this._currSoundChannel=null,this._currSound=null,this._currBg=""},r.play=function(e){if(this._currBg!=e){this.stop(),this._currBg=e;var t=this.getSound(e);t&&this.playSound(t)}},r.playSound=function(e){this._currSound=e,this._currSoundChannel=this._currSound.play(0,1),this._currSoundChannel.volume=this._volume},r.setVolume=function(e){this._volume=e,this._currSoundChannel&&(this._currSoundChannel.volume=this._volume)},r.loadedPlay=function(e){this._currBg==e&&this.playSound(RES.getRes(e))},r.checkCanClear=function(e){return this._currBg!=e},t}(BaseSound);egret.registerClass(SoundBg,"SoundBg");var SoundEffects=function(e){function t(){e.call(this)}__extends(t,e);var n=(__define,t),r=n.prototype;return r.play=function(e){var t=this.getSound(e);t&&this.playSound(t)},r.playSound=function(e){var t=e.play(0,1);t.volume=this._volume},r.setVolume=function(e){this._volume=e},r.loadedPlay=function(e){this.playSound(RES.getRes(e))},t}(BaseSound);egret.registerClass(SoundEffects,"SoundEffects");var SoundManager=function(e){function t(){e.call(this),this.bgOn=!0,this.effectOn=!0,this.bgVolume=.5,this.effectVolume=.5,this.bg=new SoundBg,this.bg.setVolume(this.bgVolume),this.effect=new SoundEffects,this.effect.setVolume(this.effectVolume)}__extends(t,e);var n=(__define,t),r=n.prototype;return r.playEffect=function(e){this.effectOn&&this.effect.play(e)},r.playBg=function(e){this.currBg=e,this.bgOn&&this.bg.play(e)},r.stopBg=function(){this.bg.stop()},r.setEffectOn=function(e){this.effectOn=e},r.setBgOn=function(e){this.bgOn=e,this.bgOn?this.currBg&&this.playBg(this.currBg):this.stopBg()},r.setBgVolume=function(e){e=Math.min(e,1),e=Math.max(e,0),this.bgVolume=e,this.bg.setVolume(this.bgVolume)},r.getBgVolume=function(){return this.bgVolume},r.setEffectVolume=function(e){e=Math.min(e,1),e=Math.max(e,0),this.effectVolume=e,this.effect.setVolume(this.effectVolume)},r.getEffectVolume=function(){return this.effectVolume},t.CLEAR_TIME=18e4,t}(BaseClass);egret.registerClass(SoundManager,"SoundManager");var AverageUtils=function(){function e(e){void 0===e&&(e=10),this.nums=[],this.numsLen=0,this.numSum=0,this.maxNum=e}var t=(__define,e),n=t.prototype;return n.push=function(e){this.numsLen>this.maxNum&&(this.numsLen--,this.numSum-=this.nums.shift()),this.nums.push(e),this.numSum+=e,this.numsLen++},n.getValue=function(){return this.numSum/this.numsLen},n.clear=function(){this.nums.splice(0),this.numsLen=0,this.numSum=0},e}();egret.registerClass(AverageUtils,"AverageUtils");var DebugUtils=function(e){function t(){e.call(this),this._threshold=3,this._startTimes={}}__extends(t,e);var n=__define,r=t,i=r.prototype;return i.isOpen=function(e){this._isOpen=e},n(i,"isDebug",function(){return this._isOpen}),i.start=function(e){this._isOpen&&(this._startTimes[e]=egret.getTimer())},i.stop=function(e){if(!this._isOpen)return 0;if(!this._startTimes[e])return 0;var t=egret.getTimer()-this._startTimes[e];return t>this._threshold&&Log.trace(e+": "+t),t},i.setThreshold=function(e){this._threshold=e},t}(BaseClass);egret.registerClass(DebugUtils,"DebugUtils");var DeviceUtils=function(e){function t(){e.call(this)}__extends(t,e);var n=__define,r=t,i=r.prototype;return n(i,"IsHtml5",function(){return egret.Capabilities.runtimeType==egret.RuntimeType.WEB}),n(i,"IsNative",function(){return egret.Capabilities.runtimeType==egret.RuntimeType.NATIVE}),n(i,"IsMobile",function(){return egret.Capabilities.isMobile}),n(i,"IsPC",function(){return!egret.Capabilities.isMobile}),n(i,"IsQQBrowser",function(){return this.IsHtml5&&-1!=navigator.userAgent.indexOf("MQQBrowser")}),n(i,"IsIEBrowser",function(){return this.IsHtml5&&-1!=navigator.userAgent.indexOf("MSIE")}),n(i,"IsFirefoxBrowser",function(){return this.IsHtml5&&-1!=navigator.userAgent.indexOf("Firefox")}),n(i,"IsChromeBrowser",function(){return this.IsHtml5&&-1!=navigator.userAgent.indexOf("Chrome")}),n(i,"IsSafariBrowser",function(){return this.IsHtml5&&-1!=navigator.userAgent.indexOf("Safari")}),n(i,"IsOperaBrowser",function(){return this.IsHtml5&&-1!=navigator.userAgent.indexOf("Opera")}),t}(BaseClass);egret.registerClass(DeviceUtils,"DeviceUtils");var DisplayUtils=function(e){function t(){e.call(this)}__extends(t,e);var n=(__define,t),r=n.prototype;return r.createBitmap=function(e){var t=new egret.Bitmap,n=RES.getRes(e);return t.texture=n,t},r.createEuiImage=function(e){var t=new eui.Image,n=RES.getRes(e);return t.source=n,t},r.removeFromParent=function(e){void 0!=e&&null!=e.parent&&e.parent.removeChild(e)},t}(BaseClass);egret.registerClass(DisplayUtils,"DisplayUtils");var Log=function(){function e(){}var t=(__define,e);t.prototype;return e.trace=function(){for(var e=[],t=0;t<arguments.length;t++)e[t-0]=arguments[t];App.DebugUtils.isDebug&&(e[0]="[Log]"+e[0],console.log.apply(console,e))},e.error=function(){for(var e=[],t=0;t<arguments.length;t++)e[t-0]=arguments[t];App.DebugUtils.isDebug&&(e[0]="[Error]"+e[0],console.log.apply(console,e))},e}();egret.registerClass(Log,"Log");var MessageCenter=function(e){function t(t){e.call(this),this.type=t,this.dict={},this.eVec=new Array,this.lastRunTime=0,0==this.type&&App.TimerManager.doFrame(1,0,this.run,this)}__extends(t,e);var n=(__define,t),r=n.prototype;return r.clear=function(){this.dict={},this.eVec.splice(0)},r.addListener=function(e,t,n){var r=this.dict[e];null==r&&(r=new Array,this.dict[e]=r);var i=0,s=r.length;for(i;s>i;i++)if(r[i][0]==t&&r[i][1]==n)return;r.push([t,n])},r.removeListener=function(e,t,n){var r=this.dict[e];if(null!=r){var i=0,s=r.length;for(i;s>i;i++)if(r[i][0]==t&&r[i][1]==n){r.splice(i,1);break}0==r.length&&(this.dict[e]=null,delete this.dict[e])}},r.removeAll=function(e){for(var t=Object.keys(this.dict),n=0,r=t.length;r>n;n++){for(var i=t[n],s=this.dict[i],o=0;o<s.length;o++)s[o][1]==e&&(s.splice(o,1),o--);0==s.length&&(this.dict[i]=null,delete this.dict[i])}},r.dispatch=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];if(null!=this.dict[e]){var r=ObjectPool.pop("MessageVo");r.type=e,r.param=t,0==this.type?this.eVec.push(r):1==this.type?this.dealMsg(r):Log.trace("MessageCenter未实现的类型")}},r.run=function(){var e=egret.getTimer(),t=e-this.lastRunTime>100;if(this.lastRunTime=e,t)for(;this.eVec.length>0;)this.dealMsg(this.eVec.shift());else for(;this.eVec.length>0&&(this.dealMsg(this.eVec.shift()),!(egret.getTimer()-e>5)););},r.dealMsg=function(e){for(var t=this.dict[e.type],n=0,r=t.length,i=null;r>n;)i=t[n],i[0].apply(i[1],e.param),t.length!=r&&(r=t.length,n--),n++;e.dispose(),ObjectPool.push(e)},t}(BaseClass);egret.registerClass(MessageCenter,"MessageCenter");var MessageVo=function(){function e(){}var t=(__define,e),n=t.prototype;return n.dispose=function(){this.type=null,this.param=null},e}();egret.registerClass(MessageVo,"MessageVo");var ObjectPool=function(){function e(){this._objs=new Array}var t=(__define,e),n=t.prototype;return n.pushObj=function(e){this._objs.push(e)},n.popObj=function(){return this._objs.length>0?this._objs.pop():null},n.clear=function(){for(;this._objs.length>0;)this._objs.pop()},e.pop=function(t){for(var n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];e._content[t]||(e._content[t]=[]);var i=e._content[t];if(i.length)return i.pop();var s,o=egret.getDefinitionByName(t),a=n.length;return 0==a?s=new o:1==a?s=new o(n[0]):2==a?s=new o(n[0],n[1]):3==a?s=new o(n[0],n[1],n[2]):4==a?s=new o(n[0],n[1],n[2],n[3]):5==a&&(s=new o(n[0],n[1],n[2],n[3],n[4])),s.ObjectPoolKey=t,s},e.popWithExtraKey=function(t,n){e._content[t]||(e._content[t]=[]);var r,i=e._content[t];if(i.length)for(var s=0;s<i.length;s++)if(i[s].extraKey==n){r=i[s],i.splice(s,1);break}if(!r){var o=egret.getDefinitionByName(t);r=new o(n),r.extraKey=n,r.ObjectPoolKey=t}return r},e.push=function(t){if(null==t)return!1;var n=t.ObjectPoolKey;return e._content[n]?(e._content[n].push(t),!0):!1},e.clear=function(){e._content={}},e.clearClass=function(t,n){void 0===n&&(n=null);for(var r=e._content[t];r&&r.length;){var i=r.pop();n&&i[n](),i=null}e._content[t]=null,delete e._content[t]},e.dealFunc=function(t,n){var r=e._content[t];if(null!=r){var i=0,s=r.length;for(i;s>i;i++)r[i][n]()}},e._content={},e}();egret.registerClass(ObjectPool,"ObjectPool");var ResVersionManager=function(e){function t(){e.call(this),this.res_loadByVersion()}__extends(t,e);var n=(__define,t),r=n.prototype;return r.res_loadByVersion=function(){RES.web.Html5VersionController.prototype.getVirtualUrl=function(e){var n="",r=t.resVersionData,i=e.substring(9);return r&&r[i]&&(n=r[i]),0==n.length&&(n=Math.random()+""),e+=-1==e.indexOf("?")?"?v="+n:"&v="+n}},r.loadConfig=function(e,t,n){this.complateFunc=t,this.complateFuncTarget=n,RES.getResByUrl(e,this.loadResVersionComplate,this)},r.loadResVersionComplate=function(e){t.resVersionData=e,this.complateFunc.call(this.complateFuncTarget)},t}(BaseClass);egret.registerClass(ResVersionManager,"ResVersionManager");var ResourceUtils=function(e){function t(){e.call(this),this._groupIndex=0,this._configs=new Array,this._groups={},RES.addEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResourceLoadComplete,this),RES.addEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onResourceLoadProgress,this),RES.addEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onResourceLoadError,this)
}__extends(t,e);var n=(__define,t),r=n.prototype;return r.addConfig=function(e,t){this._configs.push([e,t])},r.loadConfig=function(e,t){this._onConfigComplete=e,this._onConfigCompleteTarget=t,this.loadNextConfig()},r.loadNextConfig=function(){if(0==this._configs.length)return this._onConfigComplete.call(this._onConfigCompleteTarget),this._onConfigComplete=null,void(this._onConfigCompleteTarget=null);var e=this._configs.shift();RES.addEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigCompleteHandle,this),RES.loadConfig(e[0],e[1])},r.onConfigCompleteHandle=function(e){RES.removeEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigCompleteHandle,this),this.loadNextConfig()},r.loadGroup=function(e,t,n,r){this._groups[e]=[t,n,r],RES.loadGroup(e)},r.loadGroups=function(e,t,n,r,i){RES.createGroup(e,t,!0),this.loadGroup(e,n,r,i)},r.pilfererLoadGroup=function(e,t){void 0===t&&(t=null);var n="pilferer_"+e;t||(t=[e]),RES.createGroup(n,t,!0),RES.loadGroup(n,-1)},r.onResourceLoadComplete=function(e){var t=e.groupName;if(this._groups[t]){var n=this._groups[t][0],r=this._groups[t][2];null!=n&&n.call(r),this._groups[t]=null,delete this._groups[t]}},r.onResourceLoadProgress=function(e){var t=e.groupName;if(this._groups[t]){var n=this._groups[t][1],r=this._groups[t][2];null!=n&&n.call(r,e.itemsLoaded,e.itemsTotal)}},r.onResourceLoadError=function(e){Log.trace(e.groupName+"资源组有资源加载失败"),this.onResourceLoadComplete(e)},r.loadResource=function(e,t,n,r,i){void 0===e&&(e=[]),void 0===t&&(t=[]),void 0===n&&(n=null),void 0===r&&(r=null),void 0===i&&(i=null);var s=e.concat(t),o="loadGroup"+this._groupIndex++;RES.createGroup(o,s,!0),this._groups[o]=[n,r,i],RES.loadGroup(o)},t}(BaseClass);egret.registerClass(ResourceUtils,"ResourceUtils");var StageUtils=function(e){function t(){e.call(this),null==t._uiStage&&(t._uiStage=new eui.UILayer,t._uiStage.percentHeight=100,t._uiStage.percentWidth=100,t._uiStage.touchEnabled=!1,this.getStage().addChild(t._uiStage))}__extends(t,e);var n=(__define,t),r=n.prototype;return r.getHeight=function(){return this.getStage().stageHeight},r.getWidth=function(){return this.getStage().stageWidth},r.setTouchChildren=function(e){this.getStage().touchChildren=e},r.setMaxTouches=function(e){this.getStage().maxTouches=e},r.setFrameRate=function(e){this.getStage().frameRate=e},r.setScaleMode=function(e){this.getStage().scaleMode=e},r.getStage=function(){return egret.MainContext.instance.stage},r.getUIStage=function(){return t._uiStage},t}(BaseClass);egret.registerClass(StageUtils,"StageUtils");var TimerManager=function(e){function t(){e.call(this),this._handlers=new Array,this._delHandlers=new Array,this._currTime=egret.getTimer(),this._currFrame=0,this._count=0,this._timeScale=1,egret.Ticker.getInstance().register(this.onEnterFrame,this)}__extends(t,e);var n=__define,r=t,i=r.prototype;return i.setTimeScale=function(e){this._timeScale=e},i.onEnterFrame=function(){this._currFrame++,this._currTime=egret.getTimer(),App.DebugUtils.start("TimerManager:");for(var e=0;e<this._count;e++){var t=this._handlers[e],n=t.userFrame?this._currFrame:this._currTime;n>=t.exeTime&&(App.DebugUtils.start(t.method.toString()),t.method.call(t.methodObj,(this._currTime-t.dealTime)*this._timeScale),App.DebugUtils.stop(t.method.toString()),t.dealTime=this._currTime,t.exeTime+=t.delay,t.repeat||(t.repeatCount>1?t.repeatCount--:(t.complateMethod&&t.complateMethod.apply(t.complateMethodObj),this._delHandlers.push(t))))}for(;this._delHandlers.length;){var t=this._delHandlers.pop();this.remove(t.method,t.methodObj)}App.DebugUtils.stop("TimerManager:")},i.create=function(e,t,n,r,i,s,o){if(!(0>t||0>n||null==r)){this.remove(r,i);var a=ObjectPool.pop("TimerHandler");a.userFrame=e,a.repeat=0==n,a.repeatCount=n,a.delay=t,a.method=r,a.methodObj=i,a.complateMethod=s,a.complateMethodObj=o,a.exeTime=t+(e?this._currFrame:this._currTime),a.dealTime=this._currTime,this._handlers.push(a),this._count++}},i.doTimer=function(e,t,n,r,i,s){void 0===i&&(i=null),void 0===s&&(s=null),this.create(!1,e,t,n,r,i,s)},i.doFrame=function(e,t,n,r,i,s){void 0===i&&(i=null),void 0===s&&(s=null),this.create(!0,e,t,n,r,i,s)},n(i,"count",function(){return this._count}),i.remove=function(e,t){for(var n=0;n<this._count;n++){var r=this._handlers[n];if(r.method==e&&r.methodObj==t){this._handlers.splice(n,1),ObjectPool.push(r),this._count--;break}}},i.removeAll=function(e){for(var t=0;t<this._count;t++){var n=this._handlers[t];n.methodObj==e&&(this._handlers.splice(t,1),ObjectPool.push(n),this._count--,t--)}},i.isExists=function(e,t){for(var n=0;n<this._count;n++){var r=this._handlers[n];if(r.method==e&&r.methodObj==t)return!0}return!1},t}(BaseClass);egret.registerClass(TimerManager,"TimerManager");var TimerHandler=function(){function e(){this.delay=0,this.repeatCount=0,this.exeTime=0,this.dealTime=0}var t=(__define,e),n=t.prototype;return n.clear=function(){this.method=null,this.methodObj=null,this.complateMethod=null,this.complateMethodObj=null},e}();egret.registerClass(TimerHandler,"TimerHandler");var TipsUtils=function(e){function t(){e.call(this),this._ctips=new Array}__extends(t,e);var n=(__define,t),r=n.prototype;return r.showCenter=function(e){for(var t=null,n=0;n<this._ctips.length;n++)if(0==this._ctips[n].getStatus()){t=this._ctips[n];break}null==t&&(t=new CenterTips,this._ctips.push(t)),t.show(e,LayerManager.UI_Tips,!0,4)},t}(BaseClass);egret.registerClass(TipsUtils,"TipsUtils");